<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Python Dissemination: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Opinionated best-practices for reproducible python scripts and packages" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>


      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Opinionated best-practices for reproducible python scripts and packages" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Python Dissemination
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Python Dissemination
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Python Dissemination
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="python_scripts.html">1. Writing Reproducible Python</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="modules.html">2. Modules, Packages, and The Search Path</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="pyproject_uv.html">3. The Project Standard: pyproject.toml</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="quality_assurance.html">4. Quality Assurance: Testing and Linting</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="release_engineering.html">5. </a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="documentation.html">6. If It Isn't Documented, It Doesn't Exist</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="ci_cd.html">7. The Gatekeeper: Continuous Integration</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="compiled_extensions.html">8. Compiled Extensions: The Shared Object Pipeline</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-python_scripts"><p>Content from <a href="python_scripts.html">Writing Reproducible Python</a></p>
<hr>
<p>Last updated on 2026-02-12 |

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/episodes/python_scripts.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is the difference between the standard library and third-party
packages?</li>
<li>How do I share a script so that it runs on someone else’s
computer?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Import and use the <code class="verbatim">pathlib</code> standard
library.</li>
<li>Identify when a script requires external dependencies (like <code class="verbatim">numpy</code>).</li>
<li>Write a self-contained script that declares its own dependencies
using inline metadata.</li>
<li>Share a script which reproducibly handles <code class="verbatim">conda</code> dependencies alongside Python.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="the-humble-script">The Humble Script<a class="anchor" aria-label="anchor" href="#the-humble-script"></a>
</h2>
<hr class="half-width">
<p>Most research software starts as a single file. You have some data,
you need to analyze it, and you write a sequence of commands to get the
job done.</p>
<p>Let’s start by creating a script that generates some data and saves
it. We will use the standard library module <code class="verbatim">pathlib</code> to handle file paths safely across
operating systems (Windows/macOS/Linux).</p>
<div class="codewrapper sourceCode" id="cb1" tangle="data/generate_data.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Define output directory</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>DATA_DIR <span class="op">=</span> Path(<span class="st">"data"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>DATA_DIR.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="kw">def</span> generate_trajectory(n_steps<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Generating trajectory with </span><span class="sc">{</span>n_steps<span class="sc">}</span><span class="ss"> steps..."</span>)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    path <span class="op">=</span> [<span class="fl">0.0</span>]</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_steps):</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>        <span class="co"># Random walk step</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>        step <span class="op">=</span> random.uniform(<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>        path.append(path[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> step)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="cf">return</span> path</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    traj <span class="op">=</span> generate_trajectory()</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    output_file <span class="op">=</span> DATA_DIR <span class="op">/</span> <span class="st">"trajectory.txt"</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>        <span class="cf">for</span> point <span class="kw">in</span> traj:</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>            f.write(<span class="ss">f"</span><span class="sc">{</span>point<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Saved to </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">"</span>)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>Generating trajectory <span class="cf">with</span> <span class="dv">100</span> steps...</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>Saved to data<span class="op">/</span>trajectory.txt</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">head</span> <span class="at">-n</span> 3 data/trajectory.txt</span></code></pre>
</div>
<p>This script uses only <strong>Built-in</strong> modules (<code class="verbatim">random</code>, <code class="verbatim">pathlib</code>).
You can send this file to anyone with Python installed, and it will
run.</p>
<div class="section level3">
<h3 id="the-need-for-external-libraries">The Need for External Libraries<a class="anchor" aria-label="anchor" href="#the-need-for-external-libraries"></a>
</h3>
<p>Standard Python is powerful, but for scientific work, we almost
always need the “Scientific Stack”: <code class="verbatim">numpy</code>,
<code class="verbatim">pandas/polars</code>, or <code class="verbatim">matplotlib</code>.</p>
<p>Let’s modify our script to calculate statistics using <code class="verbatim">numpy</code>.</p>
<div class="codewrapper sourceCode" id="cb4" tangle="data/generate_data_np.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># new dependency!!</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>DATA_DIR <span class="op">=</span> Path(<span class="st">"data"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>DATA_DIR.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="kw">def</span> generate_trajectory(n_steps<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="co"># Use numpy for efficient array generation</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    steps <span class="op">=</span> np.random.uniform(<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, n_steps)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    trajectory <span class="op">=</span> np.cumsum(steps)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="cf">return</span> trajectory</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>    traj <span class="op">=</span> generate_trajectory()</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Mean position: </span><span class="sc">{</span>np<span class="sc">.</span>mean(traj)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Std Dev: </span><span class="sc">{</span>np<span class="sc">.</span>std(traj)<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre>
</div>
<div id="the-dependency-problem" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="the-dependency-problem" class="callout-inner">
<h3 class="callout-title">The Dependency Problem</h3>
<div class="callout-content">
<p>If you send this updated file to a colleague who just installed
Python, what happens when they run it?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p><strong>It crashes.</strong></p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="pp">ModuleNotFoundError</span>: No module named <span class="st">'numpy'</span></span></code></pre>
</div>
<p>Your colleague now has to figure out how to install <code class="verbatim">numpy</code>. Do they use <code class="verbatim">pip</code>? <code class="verbatim">conda</code>? What
version? This is the start of “Dependency Hell.”</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="the-modern-solution-pep-723-metadata">The Modern Solution: PEP 723 Metadata<a class="anchor" aria-label="anchor" href="#the-modern-solution-pep-723-metadata"></a>
</h2>
<hr class="half-width">
<p>Traditionally, you would send a <code class="verbatim">requirements.txt</code> file alongside your script, or
leave comments in the script, or try to add documentation in an
email.</p>
<p>But files get separated, and versions get desynchronized.</p>
<p><a href="https://peps.python.org/pep-0723/" class="external-link"><strong>PEP
723</strong></a> is a Python standard that allows you to embed
dependency information directly into the script file. Tools like <code class="verbatim">uv</code> (a fast Python package manager) can read this
header and automatically set up the environment for you.</p>
<figure><img src="../fig/uv-pep723-flow.png" alt="Flowchart showing uv taking a script with metadata, creating a temporary environment, installing dependencies, and executing the code" class="figure mx-auto d-block"><div class="figcaption">Flowchart showing uv taking a script with
metadata, creating a temporary environment, installing dependencies, and
executing the code</div>
</figure><p>We can add a special comment block at the top of our script:</p>
<div class="codewrapper sourceCode" id="cb6" tangle="data/generate_data_np_uv.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># /// script</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># requires-python = "&gt;=3.11"</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co"># dependencies = [</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#     "numpy",</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># ]</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co"># ///</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Hello I don't crash anymore.."</span>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co"># ... rest of script ...</span></span></code></pre>
</div>
<p>Now, instead of manually installing <code class="verbatim">numpy</code>, you run the script using <code class="verbatim">uv</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">uv</span> run data/generate_data_np_uv.py</span></code></pre>
</div>
<p>When you run this command:</p>
<ol style="list-style-type: decimal">
<li>
<code class="verbatim">uv</code> reads the metadata block.</li>
<li>It creates a temporary, isolated virtual environment.</li>
<li>It installs the specified version of <code class="verbatim">numpy</code>.</li>
<li>It executes the script.</li>
</ol>
<p>This guarantees that anyone with <code class="verbatim">uv</code>
installed can run your script immediately, without messing up their own
python environments.</p>
</section><section><h2 class="section-heading" id="beyond-python-the-pixibang">Beyond Python: The <code class="verbatim">pixibang</code>
<a class="anchor" aria-label="anchor" href="#beyond-python-the-pixibang"></a>
</h2>
<hr class="half-width">
<p>PEP 723 is fantastic for installable Python packages [fn:: most often
this means things you can find on <a href="https://pypi.org/" class="external-link">PyPI</a>).</p>
<p>However, for scientific software, we often rely on compiled binaries
and libraries that are not Python packages—things like <code class="verbatim">LAMMPS</code>, <code class="verbatim">GROMACS</code>,
or <strong>eOn</strong> <a href="https://eondocs.org" class="external-link">a server-client
tool</a> for exploring the potential energy surfaces of atomistic
systems.</p>
<p>If your script needs to run a C++ binary, <code class="verbatim">pip</code> and <code class="verbatim">uv</code> cannot
help you easily. This is where <strong>pixi</strong> comes in.</p>
<p><a href="https://pixi.sh/" class="external-link"><code>pixi</code> is a package manager</a>
built on the <code class="verbatim">conda</code> ecosystem. It can
install Python packages <strong>and</strong> compiled binaries. We can
use a <a href="https://rgoswami.me/snippets/pixi-shebang-ghcoauth/" class="external-link">“pixibang”
script</a> to effectively replicate the PEP 723 experience, but for the
entire system stack.</p>
<div class="section level3">
<h3 id="example-running-minimizations-with-eon-and-pet-mad">Example: Running minimizations with eOn and PET-MAD<a class="anchor" aria-label="anchor" href="#example-running-minimizations-with-eon-and-pet-mad"></a>
</h3>
<p>Let’s write a script that drives a geometry minimization <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. This
requires:</p>
<dl>
<dt><a href="https://docs.metatensor.org/metatrain/latest/index.html" class="external-link"><strong>Metatrain/Torch</strong></a></dt>
<dd>
For the machine learning potential.
</dd>
<dt><a href="https://rgpycrumbs.rgoswami.me/" class="external-link"><strong>rgpycrumbs</strong></a></dt>
<dd>
For helper utilities.
</dd>
<dt><a href="https://eondocs.org" class="external-link"><strong>eOn Client</strong></a></dt>
<dd>
The compiled C++ binary that actually performs the minimization.
</dd>
</dl>
<p>First, we need to create the input geometry file <code class="verbatim">pos.con</code> in our directory:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; 'EOF'</span> <span class="op">&gt;</span> pos.con</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="st">Generated by ASE</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="st">preBox_header_2</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="st">25.00   25.00   25.00</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="st">90.00   90.00   90.00</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="st">postBox_header_1</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="st">postBox_header_2</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="st">4</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="st">2 1 2 4</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="st">12.01 16.00 14.01 1.01</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="st">C</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="st">Coordinates of Component 1</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="st">  11.04   11.77   12.50 0    0</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="st">  12.03   10.88   12.50 0    1</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="st">O</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="st">Coordinates of Component 2</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="st">  14.41   13.15   12.44 0    2</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="st">N</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="st">Coordinates of Component 3</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="st">  13.44   13.86   12.46 0    3</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="st">  12.50   14.51   12.49 0    4</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="st">H</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="st">Coordinates of Component 4</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="st">  10.64   12.19   13.43 0    5</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="st">  10.59   12.14   11.58 0    6</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="st">  12.49   10.52   13.42 0    7</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="st">  12.45   10.49   11.57 0    8</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="op">EOF</span></span></code></pre>
</div>
<p>Now, create the script <code class="verbatim">eon_min.py</code>. Note
the shebang line, and the use of a <code class="verbatim">git</code>
revision!</p>
<div class="codewrapper sourceCode" id="cb9" tangle="data/eon_min.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#!/usr/bin/env -S pixi exec --spec eon --spec uv -- uv run</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co"># /// script</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co"># requires-python = "&gt;=3.11"</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># dependencies = [</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#     "ase",</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#     "metatrain @ git+https://github.com/metatensor/metatrain@492f0bfaeb3ea72fda4252b0dd6c055363cf199a",</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#     "rgpycrumbs",</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co"># ]</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"># ///</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="im">from</span> rgpycrumbs.eon.helpers <span class="im">import</span> write_eon_config</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="im">from</span> rgpycrumbs.run.jupyter <span class="im">import</span> run_command_or_exit</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>repo_id <span class="op">=</span> <span class="st">"lab-cosmo/upet"</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>tag <span class="op">=</span> <span class="st">"v1.1.0"</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>url_path <span class="op">=</span> <span class="ss">f"models/pet-mad-s-</span><span class="sc">{</span>tag<span class="sc">}</span><span class="ss">.ckpt"</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>fname <span class="op">=</span> Path(url_path.replace(<span class="st">".ckpt"</span>, <span class="st">".pt"</span>))</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>fname.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>subprocess.run(</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>    [</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>        <span class="st">"mtt"</span>,</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>        <span class="st">"export"</span>,</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>        repo_id,</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>        url_path,</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>        <span class="st">"-o"</span>,</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>        fname,</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>    ],</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>    check<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>)</span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Successfully exported </span><span class="sc">{</span>fname<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>min_settings <span class="op">=</span> {</span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>    <span class="st">"Main"</span>: {<span class="st">"job"</span>: <span class="st">"minimization"</span>, <span class="st">"random_seed"</span>: <span class="dv">706253457</span>},</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>    <span class="st">"Potential"</span>: {<span class="st">"potential"</span>: <span class="st">"Metatomic"</span>},</span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>    <span class="st">"Metatomic"</span>: {<span class="st">"model_path"</span>: fname.absolute()},</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>    <span class="st">"Optimizer"</span>: {</span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>        <span class="st">"max_iterations"</span>: <span class="dv">2000</span>,</span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>        <span class="st">"opt_method"</span>: <span class="st">"lbfgs"</span>,</span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a>        <span class="st">"max_move"</span>: <span class="fl">0.5</span>,</span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a>        <span class="st">"converged_force"</span>: <span class="fl">0.01</span>,</span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>    },</span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a>}</span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a>write_eon_config(<span class="st">"."</span>, min_settings)</span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a>run_command_or_exit([<span class="st">"eonclient"</span>], capture<span class="op">=</span><span class="va">True</span>, timeout<span class="op">=</span><span class="dv">300</span>)</span></code></pre>
</div>
<p>Make it executable and run it:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">chmod</span> +x eon_min.py</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">./eon_min.py</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="unpacking-the-shebang">Unpacking the Shebang<a class="anchor" aria-label="anchor" href="#unpacking-the-shebang"></a>
</h3>
<p>The magic happens in this line: <code class="verbatim">#!/usr/bin/env -S pixi exec --spec eon --spec uv -- uv run</code></p>
<p>This is a chain of tools:</p>
<ol style="list-style-type: decimal">
<li>
<strong>pixi exec</strong>: Create an environment with <code class="verbatim">pixi</code>.</li>
<li>
<strong>–spec eon</strong>: Explicitly request the <code class="verbatim">eon</code> package (which contains the binary <code class="verbatim">eonclient</code>).</li>
<li>
<strong>–spec uv</strong>: Explicitly request <code class="verbatim">uv</code>.</li>
<li>
<strong>– uv run</strong>: Once the outer environment exists with
<code class="verbatim">eOn</code> and <code class="verbatim">uv</code>,
it hands control over to <code class="verbatim">uv run</code>.</li>
<li>
<strong>PEP 723</strong>: <code class="verbatim">uv run</code> reads
the script comments and installs the Python libraries (<code class="verbatim">ase</code>, <code class="verbatim">rgpycrumbs</code>).</li>
</ol>
<p>This gives us the best of both worlds: <code>pixi</code> provides the
compiled binaries, and <code>uv</code> handles the fast Python
resolution.</p>
<figure><img src="../fig/pixi-uv-stack.png" alt="Diagram showing the nested layers: Pixi providing system binaries like eonclient, wrapping UV which provides Python libraries like numpy, both supporting the script" class="figure mx-auto d-block"><div class="figcaption">Diagram showing the nested layers: Pixi
providing system binaries like eonclient, wrapping UV which provides
Python libraries like numpy, both supporting the script</div>
</figure>
</div>
<div class="section level3">
<h3 id="the-result">The Result<a class="anchor" aria-label="anchor" href="#the-result"></a>
</h3>
<p>When executed, the script downloads the model, exports it using <code class="verbatim">metatrain</code>, configures eOn, and runs the
binary.</p>
<pre class="example"><code>[INFO] - Using best model from epoch None
[INFO] - Model exported to '.../models/pet-mad-s-v1.1.0.pt'
Successfully exported models/pet-mad-s-v1.1.0.pt.
Wrote eOn config to 'config.ini'
EON Client
VERSION: 01e09a5
...
[Matter]          0     0.00000e+00         1.30863e+00      -53.90300
[Matter]          1     1.46767e-02         6.40732e-01      -53.91548
...
[Matter]         51     1.56025e-03         9.85039e-03      -54.04262
Minimization converged within tolerence
Saving result to min.con
Final Energy: -54.04261779785156</code></pre>
<div id="challenge-the-pure-python-minimization" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-the-pure-python-minimization" class="callout-inner">
<h3 class="callout-title">Challenge: The Pure Python Minimization</h3>
<div class="callout-content">
<p>Create a script named <code class="verbatim">ase_min.py</code> that
performs the exact same minimization on <code class="verbatim">pos.con</code>, but uses the <a href="https://ase-lib.org/" class="external-link">atomic simulation environment (ASE)</a>
built-in <code class="verbatim">LBFGS</code> optimizer instead of
eOn.</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p><strong>Hint:</strong> You will need the <code class="verbatim">metatomic</code> package to load the potential in
ASE.</p>
<ul>
<li>Do we need <code class="verbatim">pixi</code>? Try using the <code class="verbatim">uv</code> shebang only (no <code class="verbatim">pixi</code>).</li>
<li>Reuse the model file we exported earlier (<code class="verbatim">models/pet-mad-s-v1.1.0.pt</code>).</li>
<li>Compare the “User Time” of this script vs the EON script.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12" tangle="data/ase_min.py">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># /// script</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co"># requires-python = "&gt;=3.11"</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co"># dependencies = [</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#     "ase",</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#     "metatomic",</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#     "numpy",</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># ]</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co"># ///</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="im">from</span> ase.io <span class="im">import</span> read</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="im">from</span> ase.optimize <span class="im">import</span> LBFGS</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="im">from</span> metatomic.torch.ase_calculator <span class="im">import</span> MetatomicCalculator</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="kw">def</span> run_ase_min():</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    atoms <span class="op">=</span> read(<span class="st">"pos.con"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>    <span class="co"># Reuse the .pt file exported by the previous script</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>    atoms.calc <span class="op">=</span> MetatomicCalculator(</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>        <span class="st">"models/pet-mad-s-v1.1.0.pt"</span>, </span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>        device<span class="op">=</span><span class="st">"cpu"</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>    )</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>    <span class="co"># Setup Optimizer</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Initial Energy: </span><span class="sc">{</span>atoms<span class="sc">.</span>get_potential_energy()<span class="sc">:.5f}</span><span class="ss"> eV"</span>)</span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>    opt <span class="op">=</span> LBFGS(atoms, logfile<span class="op">=</span><span class="st">"-"</span>) <span class="co"># Log to stdout</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>    opt.run(fmax<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Final Energy:   </span><span class="sc">{</span>atoms<span class="sc">.</span>get_potential_energy()<span class="sc">:.5f}</span><span class="ss"> eV"</span>)</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>    run_ase_min()</span></code></pre>
</div>
<pre class="example"><code>Initial Energy: -53.90300 eV
       Step     Time          Energy          fmax
....
LBFGS:   64 20:42:09      -54.042595        0.017080
LBFGS:   65 20:42:09      -54.042610        0.009133
Final Energy:   -54.04261 eV</code></pre>
<p>So we get the same result, but with more steps…</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="key-features-of-the-pixibang">Key Features of the Pixibang<a class="anchor" aria-label="anchor" href="#key-features-of-the-pixibang"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>The Shebang:</strong> <code class="verbatim">#!/usr/bin/env -S pixi run python</code> tells the
shell to use <code class="verbatim">pixi</code> to execute the
script.</li>
<li>
<strong>Channels:</strong> We can specify <code class="verbatim">conda-forge</code> (for general tools) and <code class="verbatim">lab-cosmo</code> (where the EON package lives).</li>
<li>
<strong>Binary Access:</strong> Because we listed <code class="verbatim">eon</code> in the dependencies, the <code class="verbatim">eonclient</code> binary is automatically downloaded and
added to the path when the script runs.</li>
</ol>
<p>This file is now a completely portable scientific workflow. You can
email it to a collaborator, and if they have <code class="verbatim">pixi</code> installed, they can run your simulation
without compiling a single line of C++.</p>
<div id="challenge-when-to-use-what" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-when-to-use-what" class="callout-inner">
<h3 class="callout-title">Challenge: When to use what?</h3>
<div class="callout-content">
<p>You have three scenarios. Which tool (<code class="verbatim">pip</code>, <code class="verbatim">uv</code>, or <code class="verbatim">pixi</code>) fits best?</p>
<ol style="list-style-type: decimal">
<li>You are writing a quick script to plot a CSV file using <code class="verbatim">matplotlib</code>.</li>
<li>You are writing a workflow that needs to run <code class="verbatim">openmm</code> and <code class="verbatim">ffmpeg</code>
(to make movies).</li>
<li>You are working on a machine where you don’t have permission to
install Conda, but you can use a virtual environment.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>
<strong>uv (PEP 723):</strong> Perfect for pure Python dependencies
like <del>matplotlib</del>. It’s fast and standard.</li>
<li>
<strong>pixi:</strong> Perfect here. <code class="verbatim">openmm</code> and <code class="verbatim">ffmpeg</code>
are complex binary dependencies that are often painful to install via
<code class="verbatim">pip</code> alone.</li>
<li>
<strong>pip/uv:</strong> If you cannot use Conda/Pixi, standard
Python tools are your fallback, though you might have to install system
libraries manually.</li>
</ol>
</div>
</div>
</div>
</div>
<table class="table"><tbody>
<tr>
<td align="left">Feature</td>
<td align="left">EON Script (Pixi)</td>
<td align="left">ASE Script (UV)</td>
</tr>
<tr>
<td align="left"><strong>Shebang</strong></td>
<td align="left"><code class="verbatim">pixi exec ... -- uv run</code></td>
<td align="left"><code class="verbatim">uv run</code></td>
</tr>
<tr>
<td align="left"><strong>Engine</strong></td>
<td align="left">C++ Binary (<code class="verbatim">eonclient</code>)</td>
<td align="left">Python Loop (<code class="verbatim">LBFGS</code>)</td>
</tr>
<tr>
<td align="left"><strong>Dependencies</strong></td>
<td align="left">System + Python</td>
<td align="left">Pure Python</td>
</tr>
<tr>
<td align="left"><strong>Use Case</strong></td>
<td align="left">HPC / Heavy Simulations</td>
<td align="left">Analysis / Prototyping</td>
</tr>
</tbody></table>
<p>While the Python version seems easier to setup, the eOn C++ client is
often more performant, and equally trivial with the c.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<strong>PEP 723</strong> allows inline metadata for Python
dependencies.</li>
<li>Use <strong>uv</strong> to run single-file scripts with pure Python
requirements (<code class="verbatim">numpy</code>, <code class="verbatim">pandas</code>).</li>
<li>Use <strong>Pixi</strong> when your script depends on system
libraries or compiled binaries (<code class="verbatim">eonclient</code>,
<code class="verbatim">ffmpeg</code>).</li>
<li>Combine them with a <strong>Pixibang</strong> (<code class="verbatim">pixi exec ... -- uv run</code>) for fully reproducible,
complex scientific workflows.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>A subset of the <a href="https://atomistic-cookbook.org/examples/eon-pet-neb/eon-pet-neb.html" class="external-link">Cookbook
recipe</a> for saddle point optimization<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-modules"><p>Content from <a href="modules.html">Modules, Packages, and The Search Path</a></p>
<hr>
<p>Last updated on 2026-02-11 |

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/episodes/modules.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How does Python know where to find the libraries you import?</li>
<li>What distinguishes a python “script” from a python “package”?</li>
<li>What is an <code class="verbatim">__init__.py</code> file?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Inspect the <code class="verbatim">sys.path</code> variable to
understand import resolution.</li>
<li>Differentiate between built-in modules, installed packages, and
local code.</li>
<li>Create a minimal local package structure.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="from-scripts-to-reusable-code">From Scripts to Reusable Code<a class="anchor" aria-label="anchor" href="#from-scripts-to-reusable-code"></a>
</h2>
<hr class="half-width">
<p>You have likely written Python scripts before: single files ending in
<code class="verbatim">.py</code> that perform a specific analysis or
task. While scripts are excellent for <strong>execution</strong>
(running a calculation once), they are often poor at facilitating
<strong>reuse</strong>.</p>
<p>Imagine you wrote a useful function to calculate the center of mass
of a molecule in <code class="verbatim">analysis.py</code>. A month
later, you start a new project and need that same function. You have two
options:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Copy and Paste:</strong> You copy the function into your new
script.
<ul>
<li>
<strong>Problem:</strong> If you find a bug in the original
function, you have to remember to fix it in every copy you made.</li>
</ul>
</li>
<li>
<strong>Importing:</strong> You tell Python to load the code from
the original file.</li>
</ol>
<p>Option 2 is the foundation of Python packaging. To do this
effectively, we must first understand how Python finds the code you ask
for.</p>
</section><section><h2 class="section-heading" id="how-python-finds-code">How Python Finds Code<a class="anchor" aria-label="anchor" href="#how-python-finds-code"></a>
</h2>
<hr class="half-width">
<p>When you type <code class="verbatim">import numpy</code>, Python does
not magically know where that code lives. It follows a deterministic
search procedure. We can see this procedure in action using the built-in
<code class="verbatim">sys</code> module.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>pprint(sys.path)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>[<span class="st">''</span>,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a> <span class="st">'/usr/lib/python314.zip'</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a> <span class="st">'/usr/lib/python3.14'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a> <span class="st">'/usr/lib/python3.14/lib-dynload'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a> <span class="st">'/usr/lib/python3.14/site-packages'</span>]</span></code></pre>
</div>
<p>The variable <code class="verbatim">sys.path</code> is a list of
directory strings. When you import a module, Python scans these
directories <strong>in order</strong>. The first match wins.</p>
<ol style="list-style-type: decimal">
<li>
<strong>The Empty String (’’)</strong>: This represents the
<strong>current working directory</strong>. This is why you can always
import a <code class="verbatim">helper.py</code> file if it is sitting
right next to your script.</li>
<li>
<strong>Standard Library</strong>: Locations like <code class="verbatim">/usr/lib/python3.*</code> contain built-ins like <code class="verbatim">os</code>, <code class="verbatim">math</code>, and
<code class="verbatim">pathlib</code>.</li>
<li>
<strong>Site Packages</strong>: Directories like <code class="verbatim">site-packages</code> or <code class="verbatim">dist-packages</code> are where tools like <code class="verbatim">pip</code>, <code class="verbatim">conda</code>, or
<code class="verbatim">pixi</code> place third-party libraries.</li>
</ol>
<div id="challenge-shadowing-the-standard-library" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-shadowing-the-standard-library" class="callout-inner">
<h3 class="callout-title">Challenge: Shadowing the Standard Library</h3>
<div class="callout-content">
<p>What happens if you create a file named <code class="verbatim">math.py</code> in your current folder with the
following content:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># math.py</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"This is my math!"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">def</span> sqrt(x):</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"No square roots here."</span></span></code></pre>
</div>
<p>And then run python and type <code class="verbatim">import math</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Python will import <strong>your</strong> local file instead of the
standard library <code class="verbatim">math</code> module.</p>
<p><strong>Why?</strong> Because the current working directory
(represented by <code class="verbatim">''</code> in <code class="verbatim">sys.path</code>) is usually at the top of the list. It
finds your <code class="verbatim">math.py</code> before scanning the
standard library paths. This is called “Shadowing” and is a common
source of bugs!</p>
</div>
</div>
</div>
</div>
<figure><img src="../fig/python-import-search-path.png" alt="Search order for packages" class="figure mx-auto d-block"><div class="figcaption">Search order for packages</div>
</figure></section><section><h2 class="section-heading" id="the-anatomy-of-a-package">The Anatomy of a Package<a class="anchor" aria-label="anchor" href="#the-anatomy-of-a-package"></a>
</h2>
<hr class="half-width">
<dl>
<dt>A <strong>Module</strong>
</dt>
<dd>
Is simply a single file ending in <code class="verbatim">.py</code>.
</dd>
<dt>A <strong>Package</strong>
</dt>
<dd>
Is a directory containing modules and a special file: <code class="verbatim">__init__.py</code>.
</dd>
</dl>
<p>Let’s create a very simple local package to handle some basic
chemistry geometry. We will call it <code class="verbatim">chemlib</code>.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">mkdir</span> chemlib</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">touch</span> chemlib/__init__.py</span></code></pre>
</div>
<p>Now, create a module inside this directory called <code class="verbatim">geometry.py</code>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">def</span> center_of_mass<span class="er">(</span><span class="ex">atoms</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="ex">print</span><span class="er">(</span><span class="st">"Calculating Center of Mass..."</span><span class="kw">)</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">[0.0,</span> 0.0, 0.0]</span></code></pre>
</div>
<p>Your directory structure should look like this:</p>
<pre class="text"><code>project_folder/
├── script.py
└── chemlib/
    ├── __init__.py
    └── geometry.py</code></pre>
</section><section><h2 class="section-heading" id="the-role-of-__init__-py">The Role of <code class="verbatim">__init__.py</code>
<a class="anchor" aria-label="anchor" href="#the-role-of-__init__-py"></a>
</h2>
<hr class="half-width">
<p>The <code class="verbatim">__init__.py</code> file tells Python:
“Treat this directory as a package.” It is the first file executed when
you import the package. It can be empty, but it is often used to expose
functions to the top level.</p>
<p>Open <code class="verbatim">chemlib/__init__.py</code> and add:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loading chemlib package..."</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="im">from</span> .geometry <span class="im">import</span> center_of_mass</span></code></pre>
</div>
<p>Now, from the <code class="verbatim">project_folder</code> (the
parent directory), launch Python:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">import</span> chemlib</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>chemlib.center_of_mass([])</span></code></pre>
</div>
<pre class="example"><code>Loading chemlib package...
Calculating Center of Mass...
[0.0, 0.0, 0.0]</code></pre>
</section><section><h2 class="section-heading" id="the-it-works-on-my-machine-problem">The “It Works on My Machine” Problem<a class="anchor" aria-label="anchor" href="#the-it-works-on-my-machine-problem"></a>
</h2>
<hr class="half-width">
<p>We have created a package, but it is fragile. It relies entirely on
the <strong>Current Working Directory</strong> being in <code class="verbatim">sys.path</code>.</p>
<div id="challenge-moving-directories" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-moving-directories" class="callout-inner">
<h3 class="callout-title">Challenge: Moving Directories</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Exit your python session.</li>
<li>Change your directory to go one level up (outside your project
folder): <code class="verbatim">cd ..</code>
</li>
<li>Start Python and try to run <code class="verbatim">import chemlib</code>.</li>
</ol>
<p>What happens and why?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p><strong>Output:</strong></p>
<pre class="example"><code>ModuleNotFoundError: No module named 'chemlib'</code></pre>
<p><strong>Reason:</strong> You moved out of the folder containing <code class="verbatim">chemlib</code>. Since the package is not installed in
the global <code class="verbatim">site-packages</code>, and the current
directory no longer contains it, Python’s search through <code class="verbatim">sys.path</code> fails to find it.</p>
</div>
</div>
</div>
</div>
<figure><img src="../fig/python-package-structure.png" alt="Directory structure for current setup" class="figure mx-auto d-block"><div class="figcaption">Directory structure for current setup</div>
</figure><p>To solve this, we need a standard way to tell Python “This package
exists, please add it to your search path permanently.” This is the job
of <strong>Packaging</strong> and <strong>Installation</strong>.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<code class="verbatim">sys.path</code> is the list of directories
Python searches for imports.</li>
<li>The order of search is: Current Directory -&gt; Standard Library
-&gt; Installed Packages.</li>
<li>A <strong>Package</strong> is a directory containing an <code class="verbatim">__init__.py</code> file.</li>
<li>The <code class="verbatim">__init__.py</code> file is the first file
loaded when <code class="verbatim">import PKG</code> is run.</li>
<li>Code that works locally because of the current directory will fail
when shared unless properly installed.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-pyproject_uv"><p>Content from <a href="pyproject_uv.html">The Project Standard: pyproject.toml</a></p>
<hr>
<p>Last updated on 2026-02-11 |

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/episodes/pyproject_uv.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I turn my folder of code into an installable library?</li>
<li>What is <code class="verbatim">pyproject.toml</code> and why is it
the standard?</li>
<li>How does <code class="verbatim">uv</code> simplify project
management?</li>
<li>Why use the <code class="verbatim">src</code> layout?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use <code class="verbatim">uv init</code> to generate a standard
<code class="verbatim">pyproject.toml</code> (PEP 621).</li>
<li>Organize code using the <code class="verbatim">src</code> layout to
prevent import errors.</li>
<li>Manage dependencies and lockfiles using <code class="verbatim">uv add</code>.</li>
<li>Run code in an isolated environment using <code class="verbatim">uv run</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="id_7ea4dd6f-c2c2-4756-9202-f6f0c2f21bbe">The Installation Problem<a class="anchor" aria-label="anchor" href="#id_7ea4dd6f-c2c2-4756-9202-f6f0c2f21bbe"></a>
</h2>
<hr class="half-width">
<p>In the previous episode, we hit a wall: our <code class="verbatim">chemlib</code> package only worked when the interpreter
starts from the project folder. To fix this, we need to
<strong>Install</strong> the package into our Python environment.</p>
<p>As far as Python is concerned, an “installation” involves placing the
files somewhere the interpreter will find them. One of the simplest ways
involves setting the <code class="verbatim">PYTHONPATH</code> terminal
variable.</p>
<figure><img src="../fig/The_Installation_Problem/2026-02-11_06-21-53_screenshot.png" alt="The packaging gradient, from the Hashemi PyBay’17 and Goswami PyCon 2020 presentation" class="figure mx-auto d-block"><div class="figcaption">The packaging gradient, from the <a href="https://www.youtube.com/watch?v=iLVNWfPWAC8" class="external-link">Hashemi PyBay’17</a>
and <a href="https://rgoswami.me/posts/pycon-in-2020-meta" class="external-link">Goswami PyCon
2020</a> presentation</div>
</figure><div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> The Packaging Timeline </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>An annotated timeline of tooling:</p>
<dl>
<dt>2003</dt>
<dd>
<a href="https://peps.python.org/pep-0301/" class="external-link">PEP 301</a> defines PyPI
</dd>
<dt>2004</dt>
<dd>
<code class="verbatim">setuptools</code> declares dependencies
</dd>
<dt>2005</dt>
<dd>
packages are hosted on PyPI
</dd>
<dt>2007</dt>
<dd>
<code class="verbatim">virtualenv</code> is released to support multiple
Python versions
</dd>
<dt>2008</dt>
<dd>
<code class="verbatim">pip</code> is released for better dependency
management
</dd>
<dt>2012</dt>
<dd>
multi-language distribution discussions from <a href="https://peps.python.org/pep-0425/" class="external-link">PEP 425</a> and <a href="https://peps.python.org/pep-0427/" class="external-link">PEP 427</a> <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</dd>
<dt>2013</dt>
<dd>
<a href="https://peps.python.org/pep-0427/" class="external-link">PEP 427</a> standardizes the
<code class="verbatim">wheel</code> format, replacing eggs
</dd>
<dt>2016</dt>
<dd>
<a href="https://peps.python.org/pep-0518/" class="external-link">PEP 518</a> introduces <code class="verbatim">pyproject.toml</code> to specify build dependencies <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
</dd>
<dt>2017</dt>
<dd>
<a href="https://peps.python.org/pep-0517/" class="external-link">PEP 517</a> separates the
build frontend (<code class="verbatim">pip</code>) from the backend
(<code class="verbatim">flit</code>, <code class="verbatim">hatch</code>, <code class="verbatim">poetry</code>)
</dd>
<dt>2020</dt>
<dd>
<a href="https://peps.python.org/pep-0621/" class="external-link">PEP 621</a> standardizes
project metadata in <code class="verbatim">pyproject.toml</code>,
removing the need for <code class="verbatim">setup.py</code>
configuration
</dd>
<dt>2022</dt>
<dd>
<a href="https://peps.python.org/pep-0668/" class="external-link">PEP 668</a> marks system
Python environments as “externally managed” to prevent accidental
breakage
</dd>
<dt>2021</dt>
<dd>
<a href="https://peps.python.org/pep-0665/" class="external-link">PEP 665</a> attempts (and
fails) to standardize lockfiles. <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>
</dd>
<dt>2024</dt>
<dd>
<a href="https://peps.python.org/pep-0723/" class="external-link">PEP 723</a> enables inline
script metadata. <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>
</dd>
<dt>2024</dt>
<dd>
<a href="https://peps.python.org/pep-0735/" class="external-link">PEP 735</a> introduces
dependency groups (e.g., separating <code class="verbatim">test</code>
or <code class="verbatim">lint</code> dependencies) without requiring a
package build.
</dd>
<dt>2025</dt>
<dd>
<a href="https://peps.python.org/pep-0751/" class="external-link">PEP 751</a> formalizes the
<code class="verbatim">pylock.toml</code> file.
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="enter-uv">Enter <code class="verbatim">uv</code>
<a class="anchor" aria-label="anchor" href="#enter-uv"></a>
</h2>
<hr class="half-width">
<p>Sometime in the early 2020s Python projects began adopting a Rust
core. Starting with <code class="verbatim">ruff</code> and moving up to
<code class="verbatim">uv</code> and <code class="verbatim">pixi</code>
in the past few years, these tools are often able cache aggressively,
and provide saner resolution of versions and other requirements for
packaging.</p>
<p>We will use <strong>uv</strong>, a convenient, modern Python package
manager, which also doubles as <a href="https://packaging.python.org/en/latest/glossary/#term-Build-Frontend" class="external-link">a
frontend</a>, replacing <code class="verbatim">pip</code> with <code class="verbatim">uv pip</code> and a backend for pure Python
distributions.</p>
</section><section><h2 class="section-heading" id="initializing-a-project">Initializing a Project<a class="anchor" aria-label="anchor" href="#initializing-a-project"></a>
</h2>
<hr class="half-width">
<p>Let’s turn our <code class="verbatim">chemlib</code> folder into a
proper project. We will use <code class="verbatim">uv init</code> to
generate the configuration.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># First, ensure we are in the project root</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="bu">cd</span> project_folder</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Initialize a library project</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="ex">uv</span> init <span class="at">--lib</span> <span class="at">--name</span> chemlib</span></code></pre>
</div>
<p>This creates a `pyproject.toml` file. Let’s inspect it.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[project]</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">name</span> = <span class="st">"chemlib"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">version</span> = <span class="st">"0.1.0"</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="ex">description</span> = <span class="st">"Add your description here"</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="ex">readme</span> = <span class="st">"README.md"</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="ex">authors</span> = [</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="kw">{</span> <span class="ex">name</span> = <span class="st">"Rohit Goswami"</span>, email = <span class="st">"rohit.goswami@epfl.ch"</span> }</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="ex">]</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="ex">requires-python</span> = <span class="st">"&gt;=3.12"</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="ex">dependencies</span> = []</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="ex">[build-system]</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="ex">requires</span> = <span class="pp">[</span><span class="st">"uv_build&gt;=0.9.26,&lt;0.10.0"</span><span class="pp">]</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="ex">build-backend</span> = <span class="st">"uv_build"</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="breakdown">Breakdown<a class="anchor" aria-label="anchor" href="#breakdown"></a>
</h2>
<hr class="half-width">
<dl>
<dt><code class="verbatim">[project]</code></dt>
<dd>
This table is standardized by <strong>PEP 621</strong>. It defines
<strong>what</strong> your package is (name, version, dependencies).
</dd>
<dt><code class="verbatim">[build-system]</code></dt>
<dd>
This defines <strong>how</strong> to build it, with an <a href="https://packaging.python.org/en/latest/glossary/#term-Build-Backend" class="external-link">appropriate
build backend</a>. <code class="verbatim">uv</code> defaults to <code class="verbatim">uv_build</code><a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>.
</dd>
</dl>
<p>The Python Packaging User Guide <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/" class="external-link">provides
a complete description</a> of the fields in the <code class="verbatim">pyproject.toml</code>.</p>
</section><section><h2 class="section-heading" id="the-src-layout">The <code class="verbatim">src</code> Layout<a class="anchor" aria-label="anchor" href="#the-src-layout"></a>
</h2>
<hr class="half-width">
<p><code class="verbatim">uv init --lib</code> automatically sets up the
<a href="https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/" class="external-link"><strong>src
layout</strong></a> for us <a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. Your folder structure should now look like
this:</p>
<pre class="example"><code>project_folder/
├── pyproject.toml
├── src/
│   └── chemlib/
│       ├── __init__.py
│       └── py.typed</code></pre>
<figure><img src="../fig/src-vs-flat-layout.png" alt="Comparison of Flat Layout vs Src Layout folder structures" class="figure mx-auto d-block"><div class="figcaption">Comparison of Flat Layout vs Src Layout folder
structures</div>
</figure><div class="section level3">
<h3 id="why-the-src-directory">Why the <code class="verbatim">src</code> directory?<a class="anchor" aria-label="anchor" href="#why-the-src-directory"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Testing against the installed package:</strong> With a flat
layout (package in root), running <code class="verbatim">pytest</code>
often imports the <strong>local folder</strong> instead of the
<strong>installed package</strong>. This hides installation bugs (like
missing data files).</li>
<li>
<strong>Cleaner root:</strong> Your root directory defines the
<strong>project</strong> (config, docs, scripts), while <code class="verbatim">src</code> holds the <strong>product</strong> (the
source code).</li>
</ol>
</div>
</section><section><h2 class="section-heading" id="managing-dependencies">Managing Dependencies<a class="anchor" aria-label="anchor" href="#managing-dependencies"></a>
</h2>
<hr class="half-width">
<p>In the first episode, we saw how <code class="verbatim">numpy</code>
caused crashes when not part of the environment. Let’s add <code class="verbatim">numpy</code> to our project properly.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">uv</span> add numpy</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">Using</span> CPython 3.11.14</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="ex">Creating</span> virtual environment at: .venv</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="ex">Resolved</span> 2 packages in 120ms</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>      <span class="ex">Built</span> chemlib @ file:///home/goswami/blah</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="ex">Prepared</span> 2 packages in 414ms</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="ex">Installed</span> 2 packages in 20ms</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a> <span class="ex">+</span> chemlib==0.1.0 <span class="er">(</span><span class="ex">from</span> file:///home/goswami/blah<span class="kw">)</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a> <span class="ex">+</span> numpy==2.4.2</span></code></pre>
</div>
<p>This performs two critical actions:</p>
<ol style="list-style-type: decimal">
<li>It adds <code class="verbatim">"numpy"</code> to the <code class="verbatim">dependencies</code> list in <code class="verbatim">pyproject.toml</code>.</li>
<li>It creates a <strong><code class="verbatim">uv.lock</code></strong>
file.</li>
</ol>
<p><strong>The Lockfile:</strong> This file records the
<strong>exact</strong> version of numpy (e.g., <code class="verbatim">2.1.0</code>) and every underlying dependency
installed. This guarantees that your teammates (and your future self)
get the exact same environment.</p>
</section><section><h2 class="section-heading" id="running-code-with-implicit-virtual-environments">Running Code with implicit virtual environments<a class="anchor" aria-label="anchor" href="#running-code-with-implicit-virtual-environments"></a>
</h2>
<hr class="half-width">
<p>You might notice that <code class="verbatim">uv</code> didn’t ask you
to activate a virtual environment. It manages one for you
automatically.</p>
<p>To run code in this project’s environment, we use <code class="verbatim">uv run</code>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Run a quick check</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">uv</span> run python <span class="at">-c</span> <span class="st">"import chemlib; print(chemlib.__file__)"</span></span></code></pre>
</div>
<pre class="example"><code>.../project_folder/.venv/lib/python3.12/site-packages/chemlib/__init__.py</code></pre>
<p>Notice the path! Python is loading <code class="verbatim">chemlib</code> from <code class="verbatim">.venv/lib/.../site-packages</code>. This means <code class="verbatim">uv</code> has performed an <strong>Editable
Install</strong>.</p>
<ul>
<li>We can edit <code class="verbatim">src/chemlib/geometry.py</code>.</li>
<li>The changes appear immediately in the installed package.</li>
<li>But Python treats it as a properly installed library.</li>
</ul>
<div id="challenge-update-the-geometry-module" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-update-the-geometry-module" class="callout-inner">
<h3 class="callout-title">Challenge: Update the Geometry Module</h3>
<div class="callout-content">
<p>Now that <code class="verbatim">numpy</code> is installed, modify
<code class="verbatim">src/chemlib/geometry.py</code> to use it.
Remember to expose the functionality within <code class="verbatim">__init__.py</code> as in the previous lesson.</p>
<ol style="list-style-type: decimal">
<li>Import <code class="verbatim">numpy</code>.</li>
<li>Change <code class="verbatim">center_of_mass</code> to accept a list
of positions and return the mean position using <code class="verbatim">np.mean</code>.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># src/chemlib/geometry.py</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="kw">def</span> center_of_mass(atoms):</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Calculating Center of Mass with NumPy..."</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="co"># Assume atoms is a list of [x, y, z] coordinates</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    data <span class="op">=</span> np.array(atoms)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="co"># Calculate mean along axis 0 (rows)</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    com <span class="op">=</span> np.mean(data, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="cf">return</span> com</span></code></pre>
</div>
<p>Test it using <code class="verbatim">uv run</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">uv</span> run python <span class="at">-c</span> <span class="st">"import chemlib; print(chemlib.center_of_mass([[0,0,0], [2,2,2]]))"</span></span></code></pre>
</div>
<p>Output:</p>
<pre class="example"><code>Calculating Center of Mass with NumPy...
[1. 1. 1.]</code></pre>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="dependency-resolution-and-conflicts">Dependency Resolution and Conflicts<a class="anchor" aria-label="anchor" href="#dependency-resolution-and-conflicts"></a>
</h2>
<hr class="half-width">
<p>A robust package manager must handle <strong>Constraint Satisfaction
Problems</strong>. You might require Library A, which relies on Library
C (v1.0), while simultaneously requiring Library B, which relies on
Library C (v2.0).</p>
<p>If these version requirements do not overlap, a conflict arises.
<code class="verbatim">uv</code> detects these impossible states before
modifying the environment.</p>
<p>Let us artificially construct a conflict using <code class="verbatim">pydantic</code>, a data validation library often used
alongside scientific tools.</p>
<div id="challenge-inducing-a-conflict" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="challenge-inducing-a-conflict" class="callout-inner">
<h3 class="callout-title">Challenge: Inducing a Conflict</h3>
<div class="callout-content">
<p>We will attempt to install incompatible versions of <code class="verbatim">pydantic</code> and <code class="verbatim">pydantic-settings</code> <a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<ol style="list-style-type: decimal">
<li>Request an older version of <code class="verbatim">pydantic</code>
(&lt;2.0).</li>
<li>Request a newer version of <code class="verbatim">pydantic-settings</code> (&gt;=2.0), which technically
depends on Pydantic 2.0+.</li>
</ol>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">uv</span> add <span class="st">"pydantic&lt;2"</span> <span class="st">"pydantic-settings&gt;=2"</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>The output should resemble:</p>
<pre class="example"><code>× No solution found when resolving dependencies:
╰─▶ Because only the following versions of pydantic-settings are available:
        pydantic-settings&lt;=2.0.0
        ...
    and pydantic-settings==2.0.0 depends on pydantic&gt;=2.0b3, we can conclude that
    pydantic-settings&gt;=2.0.0,&lt;2.0.1 depends on pydantic&gt;=2.0b3.
    And because pydantic-settings&gt;=2.0.1,&lt;=2.0.3 depends on pydantic&gt;=2.0.1, we can conclude that
    pydantic-settings&gt;=2.0.0,&lt;2.1.0 depends on pydantic&gt;=2.0b3.
    And because pydantic-settings&gt;=2.1.0,&lt;=2.2.1 depends on pydantic&gt;=2.3.0 and pydantic&gt;=2.7.0, we
    can conclude that pydantic-settings&gt;=2.0.0 depends on pydantic&gt;=2.0b3.
    And because your project depends on pydantic&lt;2 and pydantic-settings&gt;=2, we can conclude that
    your project's requirements are unsatisfiable.
help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag
      to skip locking and syncing.</code></pre>
<figure><img src="../fig/dependency-conflict.png" alt="Graph showing two dependencies requiring incompatible versions of pydantic" class="figure mx-auto d-block"><div class="figcaption">Graph showing two dependencies requiring
incompatible versions of pydantic</div>
</figure><p>This failure protects the development environment. <code class="verbatim">uv</code> refuses to install a broken state.</p>
</section><section><h2 class="section-heading" id="abstract-vs--concrete-dependencies">Abstract vs. Concrete Dependencies<a class="anchor" aria-label="anchor" href="#abstract-vs--concrete-dependencies"></a>
</h2>
<hr class="half-width">
<p>We now resolve the conflict by allowing the solver to select the
latest compatible versions (removing the manual version pins).</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">uv</span> add pydantic pydantic-settings</span></code></pre>
</div>
<p>This brings us to a critical distinction in Python packaging:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Abstract Dependencies (<code class="verbatim">pyproject.toml</code>):</strong> These define the
<strong>minimum requirements</strong> for the project. For a library
like <code class="verbatim">chemlib</code>, we prefer loose constraints
(e.g., <code class="verbatim">metatrain&gt;=0.1.0</code>) to maximize
compatibility with other packages.</li>
<li>
<strong>Concrete Dependencies (<code class="verbatim">uv.lock</code>):</strong> This file records the
<strong>exact resolution</strong> (e.g., <code class="verbatim">metatrain==0.1.5</code>, <code class="verbatim">torch==2.1.0</code>) used in development. It ensures
reproducibility.</li>
</ol>
<p>The lockfile guarantees that all developers operate on an identical
atomic substrate, eliminating the “works on my machine” class of
defects.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<strong>pyproject.toml</strong> is the standard recipe for Python
projects (PEP 621).</li>
<li>
<strong>uv add</strong> manages dependencies and ensures
reproducibility via <strong>uv.lock</strong>.</li>
<li>
<strong>uv run</strong> executes code in an isolated, editable
environment without manual activation.</li>
<li>
<strong>Isolation:</strong> <code class="verbatim">uv</code>
enforces a clean environment, preventing accidental usage of unlisted
packages.</li>
<li>
<strong>Manifest vs. Lock:</strong> <code class="verbatim">pyproject.toml</code> declares <strong>what</strong> we
need; <code class="verbatim">uv.lock</code> records <strong>exactly
what</strong> we installed.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p><code>conda</code> arrives here<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>This solves the “chicken and egg” problem of needing
tools to install tools<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>A universal lockfile standard remains elusive; tools
like <code class="verbatim">pdm</code> and <code class="verbatim">poetry</code> start providing specific
implementations.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Allows single-file scripts to declare their own
dependencies.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>For compiled code, this will need to be switched out
with <code class="verbatim">meson-python</code>, <code class="verbatim">setuptools</code>, or <code class="verbatim">scikit-build</code> to handle C++/Fortran code.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>the flat layout has some drawbacks <a href="https://blog.ionelmc.ro/2014/05/25/python-packaging/#the-structure" class="external-link">related
to testing</a>, though the <a href="https://docs.python-guide.org/writing/structure/" class="external-link">Hitchhiker’s
guide disagrees</a><a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>adapted from the <a href="https://github.com/yngvem/pycon25-tutorial/blob/main/uv/tutorial/01-introduction/04-dependencies.md" class="external-link"><code class="verbatim">uv</code> PyCon 2025 tutorial</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-quality_assurance"><p>Content from <a href="quality_assurance.html">Quality Assurance: Testing and Linting</a></p>
<hr>
<p>Last updated on 2026-02-11 |

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/episodes/quality_assurance.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I keep development tools separate from my library
dependencies?</li>
<li>How can I automatically fix style errors?</li>
<li>How do I ensure my code works as expected?</li>
<li>What are pre-commit hooks?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use <code class="verbatim">uv add --dev</code> to install tools for
developers (linting, testing).</li>
<li>Configure <code class="verbatim">ruff</code> to format code and
catch bugs.</li>
<li>Write and run a simple test suite with <code class="verbatim">pytest</code>.</li>
<li>Automate checks using <code class="verbatim">prek</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="the-works-on-my-machine-problem-again">The “Works on My Machine” Problem (Again)<a class="anchor" aria-label="anchor" href="#the-works-on-my-machine-problem-again"></a>
</h2>
<hr class="half-width">
<p>We have a <code class="verbatim">pyproject.toml</code> that defines
what our package needs to <strong>run</strong> (e.g., <code class="verbatim">numpy</code>).</p>
<p>But as developers, we need more tools. We need tools to:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Format</strong> code (so it looks professional).</li>
<li>
<strong>Lint</strong> code (to catch bugs before running).</li>
<li>
<strong>Test</strong> code (to verify correctness).</li>
</ol>
<p>We don’t want to force our users to install these tools just to
<strong>use</strong> our library. We need <strong>Development
Dependencies</strong>.</p>
</section><section><h2 class="section-heading" id="development-dependencies-with-uv">Development Dependencies with <code>uv</code>
<a class="anchor" aria-label="anchor" href="#development-dependencies-with-uv"></a>
</h2>
<hr class="half-width">
<p>We will use <code class="verbatim">uv</code> to add tools to a
special <code class="verbatim">dev</code> group. This keeps them
separate from the main <code class="verbatim">dependencies</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Add Ruff (linter), Pytest (testing), and plugins for coverage/randomization</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">uv</span> add <span class="at">--dev</span> ruff pytest pytest-cov pytest-randomly</span></code></pre>
</div>
<p>This updates <code class="verbatim">pyproject.toml</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">[dependency-groups]</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="dt">dev</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="st">"pytest&gt;=8.0.0"</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="st">"ruff&gt;=0.1.0"</span><span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="op">]</span></span></code></pre>
</div>
<figure><img src="../fig/dependency-groups.png" alt="Diagram showing how end users only get runtime dependencies while developers get both runtime and dev tools" class="figure mx-auto d-block"><div class="figcaption">Diagram showing how end users only get runtime
dependencies while developers get both runtime and dev tools</div>
</figure></section><section><h2 class="section-heading" id="linting-and-formatting-with-ruff">Linting and Formatting with <code>ruff</code>
<a class="anchor" aria-label="anchor" href="#linting-and-formatting-with-ruff"></a>
</h2>
<hr class="half-width">
<p><a href="https://astral.sh/ruff" class="external-link"><strong>Ruff</strong> is an
extremely fast static analysis tool</a> that replaces older tools like
<code class="verbatim">flake8</code> (linting), <code class="verbatim">black</code> (formatting), and <code class="verbatim">isort</code> (sorting imports).</p>
<p>Let’s see how messy our code is. Open <code class="verbatim">src/chemlib/geometry.py</code> and make it “ugly”: add
some unused imports or bad spacing.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># src/chemlib/geometry.py</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="im">import</span> os  <span class="co"># Unused import!</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="kw">def</span> center_of_mass(atoms):</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">1</span>    <span class="co"># Unused variable!</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Calculating..."</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    data <span class="op">=</span> np.array(atoms)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="cf">return</span> np.mean(data, axis<span class="op">=</span><span class="dv">0</span>)</span></code></pre>
</div>
<p>Now, run the linter:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">uv</span> run ruff check</span></code></pre>
</div>
<pre class="example"><code>src/chemlib/geometry.py:2:8: F401 [*] =os= imported but unused
src/chemlib/geometry.py:6:5: F841 [*] Local variable =x= is assigned to but never used
Found 2 errors.</code></pre>
<p><code class="verbatim">ruff</code> found code-smell. Now let’s fix
the formatting automatically:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">uv</span> run ruff format</span></code></pre>
</div>
<p>Your code is now perfectly spaced and sorted according to community
standards.</p>
</section><section><h2 class="section-heading" id="testing-with-pytest">Testing with <code class="verbatim">pytest</code>
<a class="anchor" aria-label="anchor" href="#testing-with-pytest"></a>
</h2>
<hr class="half-width">
<p>Now that the code <strong>looks</strong> right, does it
<strong>work</strong> right?</p>
<p>We need to write a test. By convention, tests live in a <code class="verbatim">tests/</code> directory at the root of your
project.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">mkdir</span> tests</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># Create __init__.py to allow relative imports within the tests directory</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">touch</span> tests/__init__.py</span></code></pre>
</div>
<p>Create a test file <code class="verbatim">tests/test_geometry.py</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">import</span> numpy as np</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">import</span> pytest</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="ex">from</span> chemlib.geometry import center_of_mass</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="ex">def</span> test_center_of_mass_simple<span class="er">(</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="st">"""Test COM of a simple diatomic molecule."""</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    <span class="ex">atoms</span> = [[0, 0, 0], [2, 0, 0]]</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    <span class="ex">expected</span> = [1.0, 0.0, 0.0]</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    <span class="ex">result</span> = center_of_mass<span class="er">(</span><span class="ex">atoms</span><span class="kw">)</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    <span class="co"># Use numpy's assertion helper for float comparisons</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="ex">np.testing.assert_allclose</span><span class="er">(</span><span class="ex">result,</span> expected<span class="kw">)</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="ex">def</span> test_center_of_mass_cube<span class="er">(</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>    <span class="st">"""Test COM of a unit cube."""</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>    <span class="ex">atoms</span> = [</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>        <span class="ex">[0,0,0],</span> <span class="pp">[</span><span class="ss">1,0,0</span><span class="pp">]</span>, <span class="pp">[</span><span class="ss">0,1,0</span><span class="pp">]</span>, <span class="pp">[</span><span class="ss">0,0,1</span><span class="pp">]</span>,</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>        <span class="ex">[1,1,0],</span> <span class="pp">[</span><span class="ss">1,0,1</span><span class="pp">]</span>, <span class="pp">[</span><span class="ss">0,1,1</span><span class="pp">]</span>, <span class="pp">[</span><span class="ss">1,1,1</span><span class="pp">]</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>    <span class="ex">]</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>    <span class="ex">expected</span> = [0.5, 0.5, 0.5]</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>    <span class="ex">result</span> = center_of_mass<span class="er">(</span><span class="ex">atoms</span><span class="kw">)</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>    <span class="ex">np.testing.assert_allclose</span><span class="er">(</span><span class="ex">result,</span> expected<span class="kw">)</span></span></code></pre>
</div>
<p>Run the tests using <code class="verbatim">uv run</code>. We include
the <code class="verbatim">--cov</code> flag (from <code class="verbatim">pytest-cov</code>) to see which lines of code our tests
executed:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">uv</span> run pytest <span class="at">--cov</span><span class="op">=</span>src</span></code></pre>
</div>
<pre class="example"><code>tests/test_geometry.py ..                                            [100%]

---------- coverage: platform linux, python 3.14 ----------
Name                        Stmts   Miss  Cover
-----------------------------------------------
src/chemlib/__init__.py         0      0   100%
src/chemlib/geometry.py         4      0   100%
-----------------------------------------------
TOTAL                           4      0   100%

========================== 2 passed in 0.04s ==========================</code></pre>
<div class="section level3">
<h3 id="why-did-this-work">Why did this work?<a class="anchor" aria-label="anchor" href="#why-did-this-work"></a>
</h3>
<p>Because of the <strong>Src Layout</strong> established earlier, <code class="verbatim">uv run</code> installs the package in editable mode.
<code class="verbatim">pytest</code> imports <code class="verbatim">chemlib</code> as if it existed as a standard installed
library.</p>
<div id="challenge-break-the-test" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-break-the-test" class="callout-inner">
<h3 class="callout-title">Challenge: Break the Test</h3>
<div class="callout-content">
<p>Modify <code class="verbatim">src/chemlib/geometry.py</code> to
introduce a bug (e.g., divide by <code class="verbatim">len(data) - 1</code> instead of the true mean).</p>
<ol style="list-style-type: decimal">
<li>Run <code class="verbatim">uv run pytest</code>. What happens?</li>
<li>Run <code class="verbatim">uv run ruff check</code>. Does the linter
catch this logic error?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>
<strong>Pytest Fails:</strong> It will show exactly where the
numbers mismatch (<code class="verbatim">AssertionError</code>).</li>
<li>
<strong>Ruff Passes:</strong> Linters check <strong>syntax</strong>
and <strong>style</strong>, not <strong>logic</strong>. This is why we
need both!</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="automating-best-practices">Automating best practices<a class="anchor" aria-label="anchor" href="#automating-best-practices"></a>
</h2>
<hr class="half-width">
<figure><img src="../fig/pre-commit-flow.png" alt="Flowchart showing git commit triggering ruff checks, which either pass to the repo or fail and require fixes" class="figure mx-auto d-block"><div class="figcaption">Flowchart showing git commit triggering ruff
checks, which either pass to the repo or fail and require fixes</div>
</figure><p>We have tools, but we have to remember to run them.
<strong>pre-commit</strong> hooks automate this by running checks
<strong>before</strong> you can commit code. We will use <code class="verbatim">prek</code>, <a href="https://prek.j178.dev/cli/" class="external-link">a
Rust rewrite</a> of the venerable <a href="https://pre-commit.com/" class="external-link">pre-commit</a>.</p>
<p>First, add it to our dev tools:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">uv</span> add <span class="at">--dev</span> prek</span></code></pre>
</div>
<p>Create a configuration file <code class="verbatim">.pre-commit-config.yaml</code> in the root
directory:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">repos:</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/astral-sh/ruff-pre-commit</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="ex">rev:</span> v0.1.0</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>      <span class="ex">-</span> id: ruff</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>        <span class="ex">args:</span> [ <span class="at">--fix</span> ]</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>      <span class="ex">-</span> id: ruff-format</span></code></pre>
</div>
<p>Now, run the hook:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">uv</span> run prek</span></code></pre>
</div>
<p>.. and finally install the action as a <code class="verbatim">git</code> hook</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">uv</span> run prek install</span></code></pre>
</div>
<pre class="example"><code>prek installed at .git/hooks/pre-commit</code></pre>
<p>Now, try to commit messy code. <code class="verbatim">git</code> will
stop you, run <code class="verbatim">ruff</code>, fix the file, and ask
you to stage the clean file. You can no longer commit ugly code by
accident!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<strong>Development Dependencies</strong> (<code class="verbatim">uv add --dev</code>) keep tools like linters separate
from library requirements.</li>
<li>
<strong>Ruff</strong> is the modern standard for fast Python linting
and formatting.</li>
<li>
<strong>Pytest</strong> verifies code correctness; <strong>Src
Layout</strong> makes test discovery reliable.</li>
<li>
<strong>Pre-commit</strong> hooks ensure no bad code ever enters
your version control history.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-release_engineering"><p>Content from <a href="release_engineering.html"></a></p>
<hr>
<p>Last updated on 2026-02-15 |

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/episodes/release_engineering.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I manage release notes without merge conflicts?</li>
<li>How do I publish my package to the world (safely)?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use <code class="verbatim">towncrier</code> to manage changelogs
using fragments.</li>
<li>Build package artifacts using <code class="verbatim">uv build</code>.</li>
<li>Publish packages to TestPyPI using <code class="verbatim">uvx twine</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="the-changelog-problem">The Changelog Problem<a class="anchor" aria-label="anchor" href="#the-changelog-problem"></a>
</h1>
<p>Before we publish code, we need to tell our users what changed. The
naive way is to edit a <code class="verbatim">CHANGELOG.md</code> file
manually. <strong>The Problem:</strong> If two people define a new
feature in a Pull Request, they both edit the top of <code class="verbatim">CHANGELOG.md</code>. This causes <strong>Merge
Conflicts</strong>.</p>
<figure><img src="../fig/towncrier-flow.png" alt="Comparison diagram showing manual changelog edits causing merge conflicts versus towncrier compiling separate fragment files" class="figure mx-auto d-block"><div class="figcaption">Comparison diagram showing manual changelog
edits causing merge conflicts versus towncrier compiling separate
fragment files</div>
</figure><div class="section level2">
<h2 id="solution-towncrier">Solution: Towncrier<a class="anchor" aria-label="anchor" href="#solution-towncrier"></a>
</h2>
<p><strong>Towncrier</strong> solves this by using “News Fragments”.
Instead of editing one big file, you create a tiny file for each
change.</p>
<p>Let’s set it up.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Add towncrier to our dev tools</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">uv</span> add <span class="at">--dev</span> towncrier</span></code></pre>
</div>
<p>Add the configuration to <code class="verbatim">pyproject.toml</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">[tool.towncrier]</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">package</span> = <span class="st">"chemlib"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">filename</span> = <span class="st">"CHANGELOG.md"</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="ex">directory</span> = <span class="st">"news"</span></span></code></pre>
</div>
<p>Now, create the news directory:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">mkdir</span> news</span></code></pre>
</div>
<div class="section level3">
<h3 id="creating-a-news-fragment">Creating a News Fragment<a class="anchor" aria-label="anchor" href="#creating-a-news-fragment"></a>
</h3>
<p>Imagine we just added the <code class="verbatim">center_of_mass</code> function. We create a file in
<code class="verbatim">news/</code>. The name must end with the type of
change (<code class="verbatim">.feature</code>, <code class="verbatim">.bugfix</code>, <code class="verbatim">.doc</code>).</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Added center_of_mass function to geometry module."</span> <span class="op">&gt;</span> news/1.feature</span></code></pre>
</div>
<p>When we are ready to release, we run:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">uv</span> run towncrier build <span class="at">--version</span> 0.1.0</span></code></pre>
</div>
<p>Towncrier will:</p>
<ol style="list-style-type: decimal">
<li>Collect all files in <code class="verbatim">news/</code>.</li>
<li>Format them into a bulleted list.</li>
<li>Prepend them to <code class="verbatim">CHANGELOG.md</code>.</li>
<li>Delete the fragment files.</li>
</ol>
<p>No merge conflicts, ever!</p>
</div>
</div>
</div>
<div class="section level1">
<h1 id="building-artifacts">Building Artifacts<a class="anchor" aria-label="anchor" href="#building-artifacts"></a>
</h1>
<p>Now that our docs are ready, we need to package our code. Python uses
two formats:</p>
<ol style="list-style-type: decimal">
<li>
<strong>sdist (.tar.gz):</strong> The raw source code.</li>
<li>
<strong>Wheel (.whl):</strong> A pre-built, ready-to-install
archive.</li>
</ol>
<figure><img src="../fig/python-artifacts.png" alt="Flowchart showing source code processed by uv build into sdist tarball and wheel file" class="figure mx-auto d-block"><div class="figcaption">Flowchart showing source code processed by uv
build into sdist tarball and wheel file</div>
</figure><p>With <code class="verbatim">uv</code>, building is trivial:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">uv</span> build</span></code></pre>
</div>
<pre class="example"><code>Building source distribution...
Building wheel...
Successfully built dist/chemlib-0.1.0.tar.gz and dist/chemlib-0.1.0-py3-none-any.whl</code></pre>
</div>
<div class="section level1">
<h1 id="publishing-to-testpypi">Publishing to TestPyPI<a class="anchor" aria-label="anchor" href="#publishing-to-testpypi"></a>
</h1>
<p>We are finally ready to ship.</p>
<figure><img src="../../episodes/fig/publish-workflow.png" class="figure mx-auto d-block"></figure><figure><img src="../fig/publish-workflow.png" alt="Sequence showing developer using uvx twine with an API token to upload artifacts to TestPyPI" class="figure mx-auto d-block"><div class="figcaption">Sequence showing developer using uvx twine with
an API token to upload artifacts to TestPyPI</div>
</figure><div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p><strong>Warning:</strong> The real PyPI is permanent. For this
workshop, we use <strong>TestPyPI</strong> (test.pypi.org), which is a
separate repository. By default, PyPI is used for resolution.</p>
</div>
</div>
</div>
<p><strong>Step 1: Get a Token</strong></p>
<ol style="list-style-type: decimal">
<li>Go to <a href="https://test.pypi.org/" class="external-link">TestPyPI</a> and create an
account.</li>
<li>Go to Settings -&gt; API Tokens -&gt; Create “Entire account”
token.</li>
<li>Copy the token (starts with <code class="verbatim">pypi-</code>).</li>
</ol>
<p><strong>Step 2: Upload using Twine</strong> We don’t need to install
<code class="verbatim">twine</code> permanently. We can use <code class="verbatim">uvx</code> (the tool execution runner) to fetch and run
it in one go.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Replace __token__ with your actual token value</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">uvx</span> twine upload <span class="dt">\</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="at">--repository</span> testpypi <span class="dt">\</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="at">--username</span> __token__ <span class="dt">\</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="at">--password</span> pypi-AgENdGVzdC5we... <span class="dt">\</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    dist/<span class="pp">*</span></span></code></pre>
</div>
<p>If successful, you can now see your package on the TestPyPI website,
and can be installed with</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">uv</span> pip install <span class="at">-i</span> <span class="st">"TEST_PYPI_URL"</span></span></code></pre>
</div>
<div id="challenge-the-full-cycle" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-the-full-cycle" class="callout-inner">
<h3 class="callout-title">Challenge: The Full Cycle</h3>
<div class="callout-content">
<p>You have built the artifact. Now prove it works!</p>
<p>Upload your package to TestPyPI using the credentials you
generated.</p>
<p>Create a one-line script <code class="verbatim">check_install.py</code>: <code class="verbatim">import chemlib; print(chemlib.file)</code>.</p>
<p>Use <code class="verbatim">uv run</code> to execute this script, but
force it to install your package from TestPyPI.</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>TestPyPI is a separate “index” (a library catalog). You will need to
tell <code class="verbatim">uv</code> where to look using the flag <code class="verbatim">--extra-index-url https://test.pypi.org/simple/</code>.
We use “extra” so it can still find dependencies like <code class="verbatim">numpy</code> on the main PyPI.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>Upload:</li>
</ol>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">uvx</span> twine upload <span class="at">--repository</span> testpypi dist/<span class="pp">*</span></span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>Verify: We use <code class="verbatim">--with chemlib</code> to
request an ephemeral environment containing our package.</li>
</ol>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"import chemlib; print('Success:', chemlib.file)"</span> <span class="op">&gt;</span> check_install.py</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">uv</span> run <span class="at">--extra-index-url</span> https://test.pypi.org/simple/ <span class="at">--with</span> chemlib check_install.py</span></code></pre>
</div>
<p>Output:</p>
<pre class="example"><code><span><span class="va">Success</span><span class="op">:</span> <span class="va">...</span><span class="op">/</span><span class="va">uv</span><span class="op">/</span><span class="va">...</span><span class="op">/</span><span class="va">site</span><span class="op">-</span><span class="va">packages</span><span class="op">/</span><span class="va">chemlib</span><span class="op">/</span><span class="va">init.py</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="automating-release-github-actions">Automating Release (GitHub Actions)<a class="anchor" aria-label="anchor" href="#automating-release-github-actions"></a>
</h1>
<div id="caution1" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<span class="callout-header">Caution</span>
<div class="callout-inner">
<div class="callout-content">
<p><strong>Warning:</strong> This may <strong>not be a good
idea</strong>, since PyPI releases cannot be removed. It is better to
set this up for TestPyPI and manually use <code class="verbatim">twine</code> or <code class="verbatim">uv</code> or
<code class="verbatim">pdm publish</code> and others locally after
ensuring everything works.</p>
</div>
</div>
</div>
<p>We can teach GitHub to do this for us. We use <strong>Trusted
Publishing (OIDC)</strong> so we don’t even need to copy-paste
passwords. The CI episode will cover GitHub Actions in full detail; for
now, here is a preview of what an automated release job looks like:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">release</span><span class="kw">:</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="at">  </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> check</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="at">  </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name == 'push' &amp;&amp; startsWith(github.ref, 'refs/tags/v')</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="at">  </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="at">  </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="at">    </span><span class="fu">id-token</span><span class="kw">:</span><span class="at"> write</span><span class="co">  # Required for OIDC</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="at">    </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="at">  </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> astral-sh/setup-uv@v5</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="at">      </span><span class="fu">run</span><span class="kw">:</span><span class="at"> uv build</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Publish to TestPyPI</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> pypa/gh-action-pypi-publish@release/v1</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="at">        </span><span class="fu">repository-url</span><span class="kw">:</span><span class="at"> https://test.pypi.org/legacy/</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">        # No password needed if configured in PyPI settings!</span></span></code></pre>
</div>
<p>Now, whenever you push a tag (e.g., <code class="verbatim">v0.1.0</code>), GitHub will build and ship your code
automatically.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<strong>Towncrier</strong> prevents changelog conflicts by using
“News Fragments”.</li>
<li>
<strong>uv build</strong> creates standard <code class="verbatim">sdist</code> and <code class="verbatim">wheel</code>
artifacts.</li>
<li>
<strong>uvx twine</strong> allows one-off publishing without
polluting your environment.</li>
<li>
<strong>TestPyPI</strong> is the sandbox for practicing release
engineering.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div></section><section id="aio-documentation"><p>Content from <a href="documentation.html">If It Isn't Documented, It Doesn't Exist</a></p>
<hr>
<p>Last updated on 2026-02-15 |

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/episodes/documentation.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 40 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I generate professional documentation for my Python
package?</li>
<li>What are docstrings, and how do they become web pages?</li>
<li>How do I link my documentation to other projects like NumPy?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write NumPy-style docstrings for functions and modules.</li>
<li>Configure <code class="verbatim">Sphinx</code> with <code class="verbatim">autoapi</code> to generate an API reference
automatically.</li>
<li>Build HTML documentation locally and verify it.</li>
<li>Deploy documentation to the web using GitHub Pages.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="the-documentation-gap">The Documentation Gap<a class="anchor" aria-label="anchor" href="#the-documentation-gap"></a>
</h1>
<p>Our <code class="verbatim">chemlib</code> package now has tests, a
changelog, and a release pipeline. A collaborator can install it from
TestPyPI with a single command. But when they type <code class="verbatim">import chemlib</code>, how do they know what functions
are available? What arguments does <code class="verbatim">center_of_mass</code> expect? What does it return?</p>
<p>Without documentation, the only option is to read the source code.
That works for you (the author), but it does not scale. New users,
reviewers, and your future self all benefit from a browsable, searchable
reference.</p>
<figure><img src="../fig/docs-pipeline.png" alt="Diagram showing source code with docstrings and conf.py feeding into Sphinx with autoapi, producing an HTML site with index and API reference pages" class="figure mx-auto d-block"><div class="figcaption">Diagram showing source code with docstrings and
conf.py feeding into Sphinx with autoapi, producing an HTML site with
index and API reference pages</div>
</figure>
</div>
<div class="section level1">
<h1 id="writing-good-docstrings">Writing Good Docstrings<a class="anchor" aria-label="anchor" href="#writing-good-docstrings"></a>
</h1>
<p>The foundation of automated documentation is the
<strong>docstring</strong>: a string literal that appears as the first
statement of a function, class, or module. Python stores it in the <code class="verbatim">__doc__</code> attribute, and tools like Sphinx extract
it to build reference pages.</p>
<p>The NumPy docstring style is the most common in scientific Python.
Let’s update <code class="verbatim">src/chemlib/geometry.py</code> with
proper docstrings:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">import</span> numpy as np</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="ex">def</span> center_of_mass<span class="er">(</span><span class="ex">atoms</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="st">"""Calculate the geometric center of mass of a set of atoms.</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="st">    Parameters</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="st">    ----------</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="st">    atoms : list of list of float</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="st">        A list of 3D coordinates, where each element is </span><span class="kw">``</span><span class="st">[x, y, z]</span><span class="kw">``</span><span class="st">.</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="st">    Returns</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="st">    -------</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="st">    numpy.ndarray</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="st">        The mean position as a 1D array of shape </span><span class="kw">``</span><span class="st">(3,)</span><span class="kw">``</span><span class="st">.</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="st">    Examples</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="st">    --------</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="st">    &gt;&gt;&gt; center_of_mass([[0, 0, 0], [2, 0, 0]])</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="st">    array([1., 0., 0.])</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>    <span class="ex">data</span> = np.array<span class="er">(</span><span class="ex">atoms</span><span class="kw">)</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>    <span class="cf">return</span> <span class="ex">np.mean</span><span class="er">(</span><span class="ex">data,</span> axis=0<span class="kw">)</span></span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>You can verify docstrings interactively at any time:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">uv</span> run python <span class="at">-c</span> <span class="st">"from chemlib.geometry import center_of_mass; help(center_of_mass)"</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="challenge-document-a-second-function" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-document-a-second-function" class="callout-inner">
<h3 class="callout-title">Challenge: Document a Second Function</h3>
<div class="callout-content">
<p>Imagine you add a helper function <code class="verbatim">distance</code> to <code class="verbatim">chemlib/geometry.py</code> that computes the Euclidean
distance between two points. Write a complete NumPy-style docstring for
it.</p>
<p>Your docstring should include:</p>
<ol style="list-style-type: decimal">
<li>A one-line summary.</li>
<li>A <code class="verbatim">Parameters</code> section with types.</li>
<li>A <code class="verbatim">Returns</code> section.</li>
<li>An <code class="verbatim">Examples</code> section.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">def</span> distance(r_a, r_b):</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="co">"""Compute the Euclidean distance between two points.</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">    r_a : array_like</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">        Coordinates of the first point, shape ``(n,)``.</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">    r_b : array_like</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">        Coordinates of the second point, shape ``(n,)``.</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">    float</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">        The Euclidean distance between ``r_a`` and ``r_b``.</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">    Examples</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">    &gt;&gt;&gt; distance([0.0, 0.0, 0.0], [1.0, 1.0, 1.0])</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">    1.7320508075688772</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>    data_a <span class="op">=</span> np.array(r_a)</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>    data_b <span class="op">=</span> np.array(r_b)</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(np.linalg.norm(data_a <span class="op">-</span> data_b))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="setting-up-sphinx">Setting Up Sphinx<a class="anchor" aria-label="anchor" href="#setting-up-sphinx"></a>
</h1>
<p><strong>Sphinx</strong> is the standard documentation generator in
the Python ecosystem. It reads source files (reStructuredText or
Markdown), follows imports into your package, and produces HTML, PDF, or
ePub output.</p>
<p>We will use a <strong>dependency group</strong> (introduced in the
<code class="verbatim">pyproject.toml</code> episode) to keep
documentation tools separate from runtime and dev dependencies:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">uv</span> add <span class="at">--group</span> docs sphinx sphinx-autoapi shibuya</span></code></pre>
</div>
<p>This creates a <code class="verbatim">docs</code> group in <code class="verbatim">pyproject.toml</code>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">[dependency-groups]</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="dt">dev</span> <span class="op">=</span> <span class="op">[</span><span class="st">"ruff&gt;=0.1.0"</span><span class="op">,</span> <span class="st">"pytest&gt;=8.0.0"</span><span class="op">]</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="dt">docs</span> <span class="op">=</span> <span class="op">[</span><span class="st">"sphinx&gt;=8.0"</span><span class="op">,</span> <span class="st">"sphinx-autoapi&gt;=3.0"</span><span class="op">,</span> <span class="st">"shibuya&gt;=2024.0"</span><span class="op">]</span></span></code></pre>
</div>
<p>Now initialise the documentation skeleton:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> docs/source</span></code></pre>
</div>
<p>Create the Sphinx configuration file <code class="verbatim">docs/source/conf.py</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">import</span> os</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">import</span> sys</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># -- Path setup --------------------------------------------------------------</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="ex">sys.path.insert</span><span class="er">(</span><span class="ex">0,</span> os.path.abspath<span class="er">(</span><span class="st">"../../src"</span><span class="kw">))</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co"># -- Project information -----------------------------------------------------</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="ex">project</span> = <span class="st">"chemlib"</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="ex">author</span> = <span class="st">"Your Name"</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co"># -- Extensions --------------------------------------------------------------</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="ex">extensions</span> = [</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    <span class="st">"autoapi.extension"</span><span class="ex">,</span>       <span class="co"># Auto-generates API pages from source</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    <span class="st">"sphinx.ext.viewcode"</span><span class="ex">,</span>     <span class="co"># Adds [source] links to API docs</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    <span class="st">"sphinx.ext.intersphinx"</span><span class="ex">,</span>  <span class="co"># Cross-links to NumPy, Python docs</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="ex">]</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co"># -- AutoAPI -----------------------------------------------------------------</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="ex">autoapi_dirs</span> = <span class="pp">[</span><span class="st">"../../src"</span><span class="pp">]</span>   <span class="co"># Where to find the package source</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="ex">autoapi_type</span> = <span class="st">"python"</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co"># -- Intersphinx -------------------------------------------------------------</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="ex">intersphinx_mapping</span> = {</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>    <span class="st">"python"</span><span class="ex">:</span> <span class="er">(</span><span class="st">"https://docs.python.org/3"</span><span class="ex">,</span> None<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>    <span class="st">"numpy"</span><span class="ex">:</span> <span class="er">(</span><span class="st">"https://numpy.org/doc/stable"</span><span class="ex">,</span> None<span class="kw">)</span><span class="ex">,</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="co"># -- Theme -------------------------------------------------------------------</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a><span class="ex">html_theme</span> = <span class="st">"shibuya"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="what-each-extension-does">What Each Extension Does<a class="anchor" aria-label="anchor" href="#what-each-extension-does"></a>
</h2>
<dl>
<dt><code class="verbatim">autoapi</code></dt>
<dd>
Scans your <code class="verbatim">src/</code> directory and builds API
reference pages for every module, class, and function. You do not need
to write <code class="verbatim">.rst</code> files by hand.
</dd>
<dt><code class="verbatim">viewcode</code></dt>
<dd>
Adds “<span class="math display">\[source\]</span>” links next to each
documented object, letting readers jump to the implementation.
</dd>
<dt><code class="verbatim">intersphinx</code></dt>
<dd>
Enables cross-project linking. When you write <code class="verbatim">:class:\`numpy.ndarray\`</code> in a docstring, Sphinx
automatically links to the NumPy documentation.
</dd>
</dl>
<p>Finally, create a minimal <code class="verbatim">docs/source/index.rst</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">chemlib</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">=======</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="ex">A</span> small computational chemistry library used to learn Python packaging.</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="ex">..</span> toctree::</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>   <span class="ex">:maxdepth:</span> 2</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>   <span class="ex">autoapi/index</span></span></code></pre>
</div>
</div>
</div>
<div class="section level1">
<h1 id="building-the-documentation">Building the Documentation<a class="anchor" aria-label="anchor" href="#building-the-documentation"></a>
</h1>
<p>With everything in place, build the HTML output:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">uv</span> run <span class="at">--group</span> docs sphinx-build <span class="at">-b</span> html docs/source docs/build/html</span></code></pre>
</div>
<pre class="example"><code>...
[autoapi] Reading files with sphinx-autoapi
[autoapi] Found package: chemlib
...
build succeeded.

The HTML pages are in docs/build/html.</code></pre>
<p>Open <code class="verbatim">docs/build/html/index.html</code> in your
browser. You should see a clean site with an “API Reference” section
listing every function and its docstring.</p>
<div id="challenge-the-missing-docstring" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-the-missing-docstring" class="callout-inner">
<h3 class="callout-title">Challenge: The Missing Docstring</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Open the generated API reference page in your browser.</li>
<li>Find a function that has <strong>no</strong> docstring (or only a
placeholder).</li>
<li>Add a proper NumPy-style docstring to it in the source code.</li>
<li>Rebuild with the <code class="verbatim">sphinx-build</code> command
above.</li>
<li>Refresh the page and verify the docstring appears.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>The rebuild cycle is:</p>
<ol style="list-style-type: decimal">
<li><p>Edit <code class="verbatim">src/chemlib/geometry.py</code> (or
whichever module).</p></li>
<li>
<p>Run:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">uv</span> run <span class="at">--group</span> docs sphinx-build <span class="at">-b</span> html docs/source docs/build/html</span></code></pre>
</div>
</li>
<li><p>Refresh the browser.</p></li>
</ol>
<p>Because <code class="verbatim">autoapi</code> re-reads the source on
every build, changes appear immediately without reinstalling the
package.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="deploying-to-the-web">Deploying to the Web<a class="anchor" aria-label="anchor" href="#deploying-to-the-web"></a>
</h1>
<p>Building locally is useful during development, but you ultimately
want the documentation available online. The most common approach in the
Python ecosystem is <strong>GitHub Pages</strong>, deployed
automatically via GitHub Actions.</p>
<p>The next episode covers Continuous Integration in detail. For now,
the key idea is that GitHub Actions can run commands automatically when
you push code. The pattern for documentation deployment is:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Build:</strong> Check out the code, install the <code class="verbatim">docs</code> group, run <code class="verbatim">sphinx-build</code>.</li>
<li>
<strong>Upload:</strong> Save the built HTML as a workflow
artifact.</li>
<li>
<strong>Deploy:</strong> On pushes to <code class="verbatim">main</code>, publish the artifact to GitHub Pages.</li>
</ol>
<!-- --><div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">name:</span> Documentation</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="ex">concurrency:</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="ex">group:</span> <span class="st">"pages"</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="ex">cancel-in-progress:</span> true</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="ex">on:</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="ex">push:</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>    <span class="ex">branches:</span> <span class="pp">[</span><span class="ss">main</span><span class="pp">]</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  <span class="ex">pull_request:</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="ex">jobs:</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="ex">docs:</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>    <span class="ex">runs-on:</span> ubuntu-latest</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    <span class="ex">permissions:</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>      <span class="ex">contents:</span> write</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>    <span class="ex">steps:</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>      <span class="ex">-</span> uses: actions/checkout@v4</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>        <span class="ex">with:</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>          <span class="ex">fetch-depth:</span> 0</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>      <span class="ex">-</span> uses: astral-sh/setup-uv@v5</span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>      <span class="ex">-</span> name: Install dependencies</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>        <span class="ex">run:</span> uv sync <span class="at">--group</span> docs</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>      <span class="ex">-</span> name: Build documentation</span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>        <span class="ex">run:</span> uv run sphinx-build <span class="at">-b</span> html docs/source docs/build/html</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>      <span class="ex">-</span> name: Upload artifact</span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>        <span class="ex">uses:</span> actions/upload-artifact@v4</span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>        <span class="ex">with:</span></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>          <span class="ex">name:</span> documentation</span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a>          <span class="ex">path:</span> docs/build/html</span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a>      <span class="ex">-</span> name: Deploy to GitHub Pages</span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a>        <span class="ex">if:</span> github.event_name == <span class="st">'push'</span> <span class="kw">&amp;&amp;</span> <span class="ex">github.ref</span> == <span class="st">'refs/heads/main'</span></span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a>        <span class="ex">uses:</span> peaceiris/actions-gh-pages@v4</span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a>        <span class="ex">with:</span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a>          <span class="ex">github_token:</span> <span class="va">${</span><span class="er">{ secrets.GITHUB_TOKEN </span><span class="va">}</span>}</span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a>          <span class="ex">publish_dir:</span> docs/build/html</span></code></pre>
</div>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>On pull requests the workflow builds the documentation and reports
success or failure, but does <strong>not</strong> deploy. This ensures
broken docs never reach the live site, while still catching build errors
before merge.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="pr-previews">PR Previews<a class="anchor" aria-label="anchor" href="#pr-previews"></a>
</h2>
<p>Catching a broken build is useful, but what about
<strong>visual</strong> regressions—a mangled table, a missing image, or
a heading that renders wrong? You cannot tell from a green checkmark
alone.</p>
<p>A <strong>PR preview</strong> solves this: a second workflow waits
for the docs build to finish, then posts a comment on the Pull Request
with a link to a temporary hosted copy of the HTML output. Reviewers can
click the link and see exactly what the documentation will look like
before merging.</p>
<figure><img src="../fig/pr-preview-flow.png" alt="Diagram showing a PR triggering docs.yml, which uploads an artifact, then pr_comment.yml downloading it and posting a preview link as a PR comment" class="figure mx-auto d-block"><div class="figcaption">Diagram showing a PR triggering docs.yml, which
uploads an artifact, then pr_comment.yml downloading it and posting a
preview link as a PR comment</div>
</figure><p>Add this second workflow file <code class="verbatim">.github/workflows/pr_comment.yml</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">name:</span> Comment on pull request</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="ex">on:</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="ex">workflow_run:</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    <span class="ex">workflows:</span> <span class="pp">[</span><span class="st">"Documentation"</span><span class="pp">]</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    <span class="ex">types:</span> <span class="pp">[</span><span class="ss">completed</span><span class="pp">]</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="ex">jobs:</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  <span class="ex">pr_comment:</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    <span class="ex">if:</span> <span class="op">&gt;</span>-</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>      <span class="ex">github.event.workflow_run.event</span> == <span class="st">'pull_request'</span> <span class="kw">&amp;&amp;</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>      <span class="ex">github.event.workflow_run.conclusion</span> == <span class="st">'success'</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    <span class="ex">runs-on:</span> ubuntu-latest</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    <span class="ex">permissions:</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>      <span class="ex">pull-requests:</span> write</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>      <span class="ex">issues:</span> write</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>      <span class="ex">actions:</span> read</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>    <span class="ex">steps:</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>      <span class="ex">-</span> uses: HaoZeke/doc-previewer@v0.0.1</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>        <span class="ex">with:</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>          <span class="ex">workflow_run_id:</span> <span class="va">${</span><span class="er">{ github.event.workflow_run.id </span><span class="va">}</span>}</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>          <span class="ex">head_sha:</span> <span class="va">${</span><span class="er">{ github.event.workflow_run.head_sha </span><span class="va">}</span>}</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>          <span class="ex">artifact_name:</span> documentation</span></code></pre>
</div>
<p>This uses a <code class="verbatim">workflow_run</code> trigger, which
means it only fires <strong>after</strong> <code class="verbatim">docs.yml</code> completes. The two-workflow pattern is
a deliberate security measure: the build workflow runs with the PR
author’s (limited) permissions, while the comment workflow runs with
write access to post on the PR. This prevents a malicious PR from using
elevated permissions during the build step.</p>
<div id="challenge-intersphinx-in-action" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-intersphinx-in-action" class="callout-inner">
<h3 class="callout-title">Challenge: Intersphinx in Action</h3>
<div class="callout-content">
<p>Add the following docstring to a function in <code class="verbatim">chemlib</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">Returns</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">-------</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">numpy.ndarray</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">    The result as a :class:`numpy.ndarray`.</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">"""</span></span></code></pre>
</div>
<p>Rebuild the docs and inspect the output.</p>
<ol style="list-style-type: decimal">
<li>Does the word <code class="verbatim">numpy.ndarray</code> become a
hyperlink?</li>
<li>Where does the link point to?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>
<strong>Yes.</strong> Sphinx resolves the <code class="verbatim">:class:\`numpy.ndarray\`</code> role using the
intersphinx inventory downloaded from <code class="verbatim">numpy.org</code>.</li>
<li>The link points to <code class="verbatim">https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html</code>.</li>
</ol>
<p>This works because we configured <code class="verbatim">intersphinx_mapping</code> with the NumPy docs URL in
<code class="verbatim">conf.py</code>. Sphinx fetches a small inventory
file (<code class="verbatim">objects.inv</code>) from that URL at build
time and uses it to resolve cross-references.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<strong>Docstrings</strong> are the raw material for documentation.
Use the NumPy style (<code class="verbatim">Parameters</code>, <code class="verbatim">Returns</code>, <code class="verbatim">Examples</code>)
for scientific code.</li>
<li>
<code class="verbatim">Sphinx</code> with <code class="verbatim">autoapi</code> generates a complete API reference by
scanning your source code, requiring no manual <code class="verbatim">.rst</code> files per module.</li>
<li>
<code class="verbatim">intersphinx</code> enables cross-project
links (e.g., to NumPy, Python), making your documentation part of the
broader ecosystem.</li>
<li>Documentation builds can be automated with GitHub Actions and
deployed to GitHub Pages on every push to <code class="verbatim">main</code>.</li>
<li>
<strong>PR Previews</strong> let reviewers see documentation changes
visually before merging, catching formatting issues that a green
checkmark cannot.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div></section><section id="aio-ci_cd"><p>Content from <a href="ci_cd.html">The Gatekeeper: Continuous Integration</a></p>
<hr>
<p>Last updated on 2026-02-15 |

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/episodes/ci_cd.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What happens if I forget to run the tests before pushing?</li>
<li>How do I ensure my code works on Windows, Linux, and macOS?</li>
<li>How do I automate <code class="verbatim">uv</code> in the
cloud?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Create a GitHub Actions workflow file that lints and tests on every
push.</li>
<li>Configure the <code class="verbatim">astral-sh/setup-uv</code>
action for cached, high-performance CI.</li>
<li>Define a test matrix to validate code across multiple Python
versions and operating systems.</li>
<li>Connect CI to the release pipeline from the Release Engineering
episode.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="the-limits-of-local-hooks">The Limits of Local Hooks<a class="anchor" aria-label="anchor" href="#the-limits-of-local-hooks"></a>
</h1>
<p>In the Quality Assurance episode, we installed <code class="verbatim">prek</code> to run <code class="verbatim">ruff</code>
before every commit. That is a good first line of defence, but it has
gaps:</p>
<ul>
<li>A collaborator can bypass hooks with <code class="verbatim">git commit --no-verify</code>.</li>
<li>Hooks only run on <strong>your</strong> machine, with
<strong>your</strong> operating system and Python version.</li>
<li>If it works on your MacBook but breaks on a colleague’s Linux
cluster, you will not find out until they complain.</li>
</ul>
<p><strong>Continuous Integration (CI)</strong> closes these gaps by
running your test suite on a neutral server every time code is pushed.
It is the “gatekeeper” that protects the <code class="verbatim">main</code> branch.</p>
<figure><img src="../fig/ci-gatekeeper-flow.png" alt="Flowchart showing a developer pushing code, GitHub Actions running checkout, install, lint, and test steps, then either allowing merge or blocking" class="figure mx-auto d-block"><div class="figcaption">Flowchart showing a developer pushing code,
GitHub Actions running checkout, install, lint, and test steps, then
either allowing merge or blocking</div>
</figure>
</div>
<div class="section level1">
<h1 id="anatomy-of-a-workflow-file">Anatomy of a Workflow File<a class="anchor" aria-label="anchor" href="#anatomy-of-a-workflow-file"></a>
</h1>
<p>GitHub Actions reads YAML files from <code class="verbatim">.github/workflows/</code>. Each file describes
<strong>when</strong> to run (<code class="verbatim">on</code>),
<strong>what machine</strong> to use (<code class="verbatim">runs-on</code>), and <strong>what commands</strong> to
execute (<code class="verbatim">steps</code>).</p>
<p>Let’s create our gatekeeper. Start by making the directory:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> .github/workflows</span></code></pre>
</div>
<p>Now create <code class="verbatim">.github/workflows/ci.yml</code>
with the following content. This mirrors exactly what we did locally in
the Quality Assurance episode: lint, then test.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">name:</span> CI</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">on:</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="ex">push:</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="ex">branches:</span> <span class="pp">[</span><span class="ss">main</span><span class="pp">]</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="ex">pull_request:</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="ex">jobs:</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="ex">check:</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    <span class="ex">name:</span> Lint and Test</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="ex">runs-on:</span> ubuntu-latest</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    <span class="ex">steps:</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>      <span class="ex">-</span> name: Checkout Code</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>        <span class="ex">uses:</span> actions/checkout@v4</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>      <span class="ex">-</span> name: Install uv</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>        <span class="ex">uses:</span> astral-sh/setup-uv@v5</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>        <span class="ex">with:</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>          <span class="ex">enable-cache:</span> true</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>      <span class="ex">-</span> name: Set up Python</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>        <span class="ex">run:</span> uv python install 3.12</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>      <span class="ex">-</span> name: Install Dependencies</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>        <span class="ex">run:</span> uv sync <span class="at">--all-extras</span> <span class="at">--dev</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>      <span class="ex">-</span> name: Lint</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>        <span class="ex">run:</span> uv run ruff check .</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>      <span class="ex">-</span> name: Format Check</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>        <span class="ex">run:</span> uv run ruff format <span class="at">--check</span> .</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>      <span class="ex">-</span> name: Test</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>        <span class="ex">run:</span> uv run pytest <span class="at">--cov</span><span class="op">=</span>src</span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>The <code class="verbatim">astral-sh/setup-uv</code> action installs
<code class="verbatim">uv</code> and (with <code class="verbatim">enable-cache: true</code>) caches the downloaded
packages between runs. This makes subsequent CI runs significantly
faster than a fresh install each time.</p>
</div>
</div>
</div>
<div id="challenge-reading-the-workflow" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-reading-the-workflow" class="callout-inner">
<h3 class="callout-title">Challenge: Reading the Workflow</h3>
<div class="callout-content">
<p>Before we push anything, make sure you understand the structure.
Answer the following:</p>
<ol style="list-style-type: decimal">
<li>Which event triggers this workflow on a pull request?</li>
<li>What operating system does the job run on?</li>
<li>Why do we use <code class="verbatim">ruff format --check</code>
instead of <code class="verbatim">ruff format</code>?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>The <code class="verbatim">pull_request</code> trigger (under <code class="verbatim">on:</code>) fires whenever a PR is opened or updated
against any branch.</li>
<li>
<code class="verbatim">ubuntu-latest</code> (a Linux virtual machine
hosted by GitHub).</li>
<li>
<code class="verbatim">--check</code> exits with an error if files
<strong>would</strong> be reformatted, without actually modifying them.
In CI we want to <strong>detect</strong> problems, not silently fix
them. The developer should run <code class="verbatim">ruff format</code>
locally and commit the result.</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="the-test-matrix">The Test Matrix<a class="anchor" aria-label="anchor" href="#the-test-matrix"></a>
</h1>
<p>The workflow above runs on one OS with one Python version. That is
better than nothing, but one of the biggest risks in scientific Python
is <strong>compatibility</strong>.</p>
<ul>
<li>A script might work on Linux but fail on Windows due to path
separators (<code class="verbatim">/</code> vs <code class="verbatim">\</code>).</li>
<li>Code might work on Python 3.12 but fail on 3.11 because it uses a
feature added in 3.12 (like <code class="verbatim">type</code> statement
syntax).</li>
<li>A filename like <code class="verbatim">aux.py</code> is perfectly
legal on Linux but reserved on Windows.</li>
</ul>
<p>A <strong>Matrix Strategy</strong> tells GitHub to run the same job
across every combination of parameters. We define the axes (Python
versions, operating systems) and GitHub spins up one runner per
combination.</p>
<p>Replace the <code class="verbatim">jobs:</code> block in your <code class="verbatim">ci.yml</code> with the version below. The <code class="verbatim">steps</code> remain identical; only the job header
changes.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">name:</span> CI</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">on:</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="ex">push:</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="ex">branches:</span> <span class="pp">[</span><span class="ss">main</span><span class="pp">]</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="ex">pull_request:</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="ex">jobs:</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="ex">check:</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="ex">name:</span> Test on <span class="va">${</span><span class="er">{ matrix.os </span><span class="va">}</span>} / Py <span class="va">${</span><span class="er">{ matrix.python-version </span><span class="va">}</span>}</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="ex">runs-on:</span> <span class="va">${</span><span class="er">{ matrix.os </span><span class="va">}</span>}</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    <span class="ex">strategy:</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>      <span class="ex">fail-fast:</span> false</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>      <span class="ex">matrix:</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>        <span class="ex">python-version:</span> [<span class="st">"3.11"</span>, <span class="st">"3.12"</span>]</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>        <span class="ex">os:</span> [ubuntu-latest, windows-latest, macos-latest]</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>    <span class="ex">steps:</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>      <span class="ex">-</span> uses: actions/checkout@v4</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>      <span class="ex">-</span> uses: astral-sh/setup-uv@v5</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>        <span class="ex">with:</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>          <span class="ex">enable-cache:</span> true</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>      <span class="ex">-</span> name: Install Python <span class="va">${</span><span class="er">{ matrix.python-version </span><span class="va">}</span>}</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>        <span class="ex">run:</span> uv python install <span class="va">${</span><span class="er">{ matrix.python-version </span><span class="va">}</span>}</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>      <span class="ex">-</span> name: Install Dependencies</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>        <span class="ex">run:</span> uv sync <span class="at">--all-extras</span> <span class="at">--dev</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>      <span class="ex">-</span> name: Lint</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>        <span class="ex">run:</span> uv run ruff check .</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>      <span class="ex">-</span> name: Format Check</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>        <span class="ex">run:</span> uv run ruff format <span class="at">--check</span> .</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>      <span class="ex">-</span> name: Test</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>        <span class="ex">run:</span> uv run pytest <span class="at">--cov</span><span class="op">=</span>src</span></code></pre>
</div>
<p>Two Python versions times three operating systems gives <strong>six
parallel jobs</strong>. If any single job fails, the Pull Request is
blocked.</p>
<figure><img src="../../episodes/fig/ci-matrix.png" class="figure mx-auto d-block"></figure><figure><img src="../fig/ci-matrix.png" alt="Diagram showing a git push triggering six parallel CI jobs across two Python versions and three operating systems, all feeding into a merge decision" class="figure mx-auto d-block"><div class="figcaption">Diagram showing a git push triggering six
parallel CI jobs across two Python versions and three operating systems,
all feeding into a merge decision</div>
</figure><div id="challenge-the-windows-path-bug" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-the-windows-path-bug" class="callout-inner">
<h3 class="callout-title">Challenge: The Windows Path Bug</h3>
<div class="callout-content">
<p>Consider the following line in <code class="verbatim">chemlib</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>data_path <span class="op">=</span> <span class="st">"src/chemlib/data/file.txt"</span></span></code></pre>
</div>
<ol style="list-style-type: decimal">
<li>Why would this fail on the <code class="verbatim">windows-latest</code> runner?</li>
<li>Rewrite it using <code class="verbatim">pathlib</code> so it works
on all three operating systems.</li>
<li>Which episode’s key lesson does this reinforce?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li><p>Windows uses backslash (<code class="verbatim">\</code>) as the
path separator. A hardcoded forward slash string will not resolve
correctly on Windows.</p></li>
<li>
<p>Use <code class="verbatim">pathlib.Path</code>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>data_path <span class="op">=</span> Path(<span class="st">"src"</span>) <span class="op">/</span> <span class="st">"chemlib"</span> <span class="op">/</span> <span class="st">"data"</span> <span class="op">/</span> <span class="st">"file.txt"</span></span></code></pre>
</div>
</li>
<li><p>The very first episode (Writing Reproducible Python), where we
introduced <code class="verbatim">pathlib</code> for cross-platform file
handling.</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="connecting-ci-to-releases">Connecting CI to Releases<a class="anchor" aria-label="anchor" href="#connecting-ci-to-releases"></a>
</h1>
<p>In the Release Engineering episode, we manually uploaded artifacts to
TestPyPI with <code class="verbatim">uvx twine</code>. We also previewed
an automated release job. Now that we understand how workflows are
structured, let’s see the complete picture.</p>
<p>Add a second job to the same <code class="verbatim">ci.yml</code>
file. This job only runs when you push a version tag (e.g., <code class="verbatim">v0.1.0</code>) and only <strong>after</strong> the test
matrix passes.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">release</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="at">  </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> check</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="at">  </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name == 'push' &amp;&amp; startsWith(github.ref, 'refs/tags/v')</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="at">  </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="at">  </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="at">    </span><span class="fu">id-token</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="at">    </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="at">  </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> astral-sh/setup-uv@v5</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="at">      </span><span class="fu">run</span><span class="kw">:</span><span class="at"> uv build</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Publish to TestPyPI</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="at">      </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> pypa/gh-action-pypi-publish@release/v1</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="at">        </span><span class="fu">repository-url</span><span class="kw">:</span><span class="at"> https://test.pypi.org/legacy/</span></span></code></pre>
</div>
<p>Key details:</p>
<dl>
<dt><code class="verbatim">needs: check</code></dt>
<dd>
The release job waits for all six matrix jobs to pass. A broken build is
never published.
</dd>
<dt><code class="verbatim">id-token: write</code></dt>
<dd>
Enables <strong>OIDC Trusted Publishing</strong>. GitHub proves its
identity to PyPI directly, so you never need to store an API token as a
secret.
</dd>
<dt>The tag filter</dt>
<dd>
Only tags starting with <code class="verbatim">v</code> (like <code class="verbatim">v0.1.0</code>) trigger the release. Normal pushes to
<code class="verbatim">main</code> run tests but do not publish.
</dd>
</dl>
<div id="challenge-the-release-workflow" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-the-release-workflow" class="callout-inner">
<h3 class="callout-title">Challenge: The Release Workflow</h3>
<div class="callout-content">
<p>Walk through the following scenario:</p>
<ol style="list-style-type: decimal">
<li>You merge a pull request to <code class="verbatim">main</code>. Does
the <code class="verbatim">release</code> job run?</li>
<li>You tag the merge commit with <code class="verbatim">git tag v0.2.0</code> and <code class="verbatim">git push --tags</code>. What happens now?</li>
<li>Imagine the <code class="verbatim">windows-latest / Py 3.11</code>
job fails. Does the release still happen?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>
<strong>No.</strong> The <code class="verbatim">if:</code> condition
requires the ref to start with <code class="verbatim">refs/tags/v</code>. A push to <code class="verbatim">main</code> does not match.</li>
<li>The tag push triggers CI. All six matrix jobs run. If they pass, the
<code class="verbatim">release</code> job runs: it builds the wheel and
sdist, then publishes to TestPyPI via OIDC.</li>
<li>
<strong>No.</strong> The <code class="verbatim">needs: check</code>
dependency means the <code class="verbatim">release</code> job is
skipped when any matrix job fails. The tag remains, and you can
re-trigger after fixing the issue.</li>
</ol>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<strong>Continuous Integration</strong> runs your test suite on a
neutral server on every push, catching problems that local hooks
miss.</li>
<li>
<code class="verbatim">astral-sh/setup-uv</code> provides a cached,
high-performance <code class="verbatim">uv</code> environment in GitHub
Actions.</li>
<li>A <strong>Matrix Strategy</strong> tests across multiple operating
systems and Python versions in parallel.</li>
<li>CI can gate releases: the <code class="verbatim">release</code> job
uses <code class="verbatim">needs:</code> to ensure tests pass before
publishing.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div></section><section id="aio-compiled_extensions"><p>Content from <a href="compiled_extensions.html">Compiled Extensions: The Shared Object Pipeline</a></p>
<hr>
<p>Last updated on 2026-02-12 |

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/episodes/compiled_extensions.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 50 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How does the Python ecosystem deliver high-performance binaries to
users?</li>
<li>What distinguishes a “Source Distribution” from a “Binary
Wheel”?</li>
<li>What role does <code class="verbatim">cibuildwheel</code> play in
software distribution?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Construct a Python extension module from a Fortran kernel using
Meson.</li>
<li>Configure a build-backend for compiled extensions using <code class="verbatim">meson-python</code>.</li>
<li>Setup a CI pipeline to generate binary wheels for distribution.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="the-shared-object-reality">The Shared Object Reality<a class="anchor" aria-label="anchor" href="#the-shared-object-reality"></a>
</h2>
<hr class="half-width">
<p>In the domain of scientific Python, “packaging” often refers
effectively to “binary distribution.” When users install libraries such
as <code class="verbatim">numpy</code>, <code class="verbatim">torch</code>, or <code class="verbatim">openblas</code>, they typically download compiled
artifacts rather than pure Python scripts.</p>
<p>Investigation of the <code>site-packages</code> directory reveals
that the core logic resides in <strong>Shared Object</strong> files
(<code>.so</code> on Linux, <code>.dylib</code> on macOS,
<code>.dll</code> on Windows). Python functions primarily as the
interface.</p>
<p>To distribute high-performance code effectively, one must master the
pipeline that generates these artifacts consisting of</p>
<dl>
<dt>Translation</dt>
<dd>
Generating C wrappers for Fortran/C++ code.
</dd>
<dt>Compilation</dt>
<dd>
Transforming source code into shared objects.
</dd>
<dt>Bundling</dt>
<dd>
Packaging shared objects into Wheels (<code>.whl</code>).
</dd>
</dl>
<figure><img src="../fig/compiled-extension-flow.png" alt="Flowchart showing f2py converting Fortran source into C wrappers, which are then compiled into a shared object" class="figure mx-auto d-block"><div class="figcaption">Flowchart showing f2py converting Fortran source
into C wrappers, which are then compiled into a shared object</div>
</figure></section><section><h2 class="section-heading" id="the-computational-kernel-in-fortran">The Computational Kernel in Fortran<a class="anchor" aria-label="anchor" href="#the-computational-kernel-in-fortran"></a>
</h2>
<hr class="half-width">
<p>We begin with a computational kernel. In physical chemistry,
calculating the Euclidean distance between atomic coordinates
constitutes a fundamental operation.</p>
<p>Create <code class="verbatim">src/chemlib/geometry.f90</code>:</p>
<div class="codewrapper sourceCode" id="cb1" tangle="data/chemlib/src/chemlib/geometry.f90">
<h3 class="code-label">F90<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode f90" tabindex="0"><code class="sourceCode fortranfree"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">subroutine</span> calc_distance(n, r_a, r_b, dist)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="kw">implicit</span> <span class="kw">none</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="dt">integer</span>, <span class="dt">intent(in)</span> <span class="dt">::</span> n</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="dt">real(8)</span>, <span class="dt">intent(in)</span>, <span class="dt">dimension(n)</span> <span class="dt">::</span> r_a, r_b</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="dt">real(8)</span>, <span class="dt">intent(out)</span> <span class="dt">::</span> dist</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="co">!f2py intent(hide) :: n</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="co">!f2py intent(in) :: r_a, r_b</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="co">!f2py intent(out) :: dist</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    <span class="dt">integer</span> <span class="dt">::</span> i</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    dist <span class="kw">=</span> <span class="fl">0.0d0</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    <span class="kw">do</span> i <span class="kw">=</span> <span class="dv">1</span>, n</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>        dist <span class="kw">=</span> dist <span class="kw">+</span> (r_a(i)<span class="kw">-</span>r_b(i))<span class="kw">**</span><span class="dv">2</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="kw">end do</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    dist <span class="kw">=</span> <span class="bu">sqrt</span>(dist)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="kw">end subroutine</span> calc_distance</span></code></pre>
</div>
<p>This can be immediately compiled through <code>f2py</code>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="bu">cd</span> src/chemlib/</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">uv</span> run f2py <span class="at">-c</span> geometry.f90 <span class="at">-m</span> tmp</span></code></pre>
</div>
<p>Which generates <code>tmp.cpython*.so</code> (or <code>.dll</code> on
Windows). We can try this out.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>❯ python</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>Python <span class="fl">3.14.2</span> (main, Jan  <span class="dv">2</span> <span class="dv">2026</span>, <span class="dv">14</span>:<span class="dv">27</span>:<span class="dv">39</span>) [GCC <span class="fl">15.2.1</span> <span class="dv">20251112</span>] on linux</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>Type <span class="st">"help"</span>, <span class="st">"copyright"</span>, <span class="st">"credits"</span> <span class="kw">or</span> <span class="st">"license"</span> <span class="cf">for</span> more information.</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> tmp</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> tmp.calc_distance([<span class="fl">0.</span>,<span class="fl">0.</span>,<span class="fl">0.</span>], [<span class="fl">1.</span>,<span class="fl">1.</span>,<span class="fl">1.</span>])</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fl">1.7320508075688772</span></span></code></pre>
</div>
<div id="challenge-validate-the-result" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-validate-the-result" class="callout-inner">
<h3 class="callout-title">Challenge: Validate the result</h3>
<div class="callout-content">
<p>Can you make sure the results are correct? Note that since we cannot
really “install” the package yet, a simple <code class="verbatim">assert</code> will have to do.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="im">import</span> tmp</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>fort_result<span class="op">=</span>tmp.calc_distance([<span class="fl">0.</span>,<span class="fl">0.</span>,<span class="fl">0.</span>], [<span class="fl">1.</span>,<span class="fl">1.</span>,<span class="fl">1.</span>])</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>np_base <span class="op">=</span> np.linalg.norm(np.asarray([<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>])<span class="op">-</span>np.asarray([<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>]))</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>np.float64(<span class="fl">1.7320508075688772</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="cf">assert</span>(np_base<span class="op">==</span>fort_result)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="considering-installable-variants-with-meson">Considering “installable” variants with <code>meson</code>
<a class="anchor" aria-label="anchor" href="#considering-installable-variants-with-meson"></a>
</h2>
<hr class="half-width">
<p>The <strong>problem</strong> with the setup so far is that the
compiled extension doesn’t get “installed” into <code class="verbatim">site-packages</code>. To work around this, it helps to
first take a look behind the curtain. <code>f2py</code> with the
<code>--build-dir</code> option will output the intermediate build
files.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="bu">cd</span> src/chemlib</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">uv</span> run f2py <span class="at">-c</span> geometry.f90 <span class="at">-m</span> tmp <span class="at">--build-dir</span> tmp_out</span></code></pre>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Build output </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">❯</span> f2py <span class="at">-c</span> geometry.f90 <span class="at">-m</span> tmp <span class="at">--build-dir</span> tmp_out</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">Cannot</span> use distutils backend with Python<span class="op">&gt;</span>=3.12, using meson backend instead.</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="ex">Using</span> meson backend</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="ex">Will</span> pass <span class="at">--lower</span> to f2py</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="ex">See</span> https://numpy.org/doc/stable/f2py/buildtools/meson.html</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="ex">Reading</span> fortran codes...</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="ex">Reading</span> file <span class="st">'geometry.f90'</span> <span class="er">(</span><span class="ex">format:free</span><span class="kw">)</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="ex">Post-processing...</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="ex">character_backward_compatibility_hook</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="ex">Post-processing</span> <span class="er">(</span><span class="ex">stage</span> 2<span class="kw">)</span><span class="ex">...</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="ex">Building</span> modules...</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    <span class="ex">Building</span> module <span class="st">"tmp"</span>...</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    <span class="ex">Generating</span> possibly empty wrappers<span class="st">"</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="st">    Maybe empty "</span>tmp-f2pywrappers.f<span class="st">"</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="st">        Constructing wrapper function "</span>calc_distance<span class="st">"...</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="st">          dist = calc_distance(r_a,r_b)</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="st">    Wrote C/API module "</span>tmp<span class="st">" to file "</span>./tmpmodule.c<span class="st">"</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="st">The Meson build system</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="st">Version: 1.10.1</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="st">Source dir: /home/rgoswami/Git/Github/epfl/pixi_envs/teaching/python_packaging_workbench/python_packaging_workbench/org_src/episodes/data/chemlib/src/chemlib/tmp_out</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="st">Build dir: /home/rgoswami/Git/Github/epfl/pixi_envs/teaching/python_packaging_workbench/python_packaging_workbench/org_src/episodes/data/chemlib/src/chemlib/tmp_out/bbdir</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="st">Build type: native build</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="st">Project name: tmp</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="st">Project version: 0.1</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="st">Fortran compiler for the host machine: gfortran (gcc 15.2.1 "</span>GNU Fortran <span class="er">(</span><span class="ex">GCC</span><span class="kw">)</span> <span class="ex">15.2.1</span> 20260103<span class="st">")</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="st">Fortran linker for the host machine: gfortran ld.bfd 2.45.1</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="st">C compiler for the host machine: cc (gcc 15.2.1 "</span>cc <span class="er">(</span><span class="ex">GCC</span><span class="kw">)</span> <span class="ex">15.2.1</span> 20260103<span class="st">")</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="st">C linker for the host machine: cc ld.bfd 2.45.1</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="st">Host machine cpu family: x86_64</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="st">Host machine cpu: x86_64</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="st">Program /usr/bin/python found: YES (/usr/bin/python)</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="st">Found pkg-config: YES (/usr/bin/pkg-config) 2.5.1</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="st">Build targets in project: 1</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="st">Found ninja-1.13.2 at /usr/bin/ninja</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="st">INFO: autodetecting backend as ninja                                    </span></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="st">INFO: calculating backend command to run: /usr/bin/ninja -C /home/rgoswami/Git/Github/epfl/pixi_envs/teaching/python_packaging_workbench/python_packaging_workbench/org_src/episodes/data/chemlib/src/chemlib/tmp_out/bbdir</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="st">ninja: Entering directory </span><span class="kw">`</span><span class="ex">/home/rgoswami/Git/Github/epfl/pixi_envs/teaching/python_packaging_workbench/python_packaging_workbench/org_src/episodes/data/chemlib/src/chemlib/tmp_out/bbdir</span><span class="st">'</span></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="st">[7/7] Linking target tmp.cpython-314-x86_64-linux-gnu.so</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Which we can then inspect..</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="bu">cd</span> data/chemlib/src/chemlib</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">ls</span> tmp_out</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">bbdir</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">geometry.f90</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="ex">meson.build</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="ex">tmp-f2pywrappers.f</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="ex">tmpmodule.c</span></span></code></pre>
</div>
<p>The intermediate involves a <code>meson.build</code> !</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">cat</span> data/chemlib/src/chemlib/tmp_out/meson.build </span></code></pre>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Generated meson.build </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<pre class="meson"><code>project('tmp',
        ['c', 'fortran'],
        version : '0.1',
        meson_version: '&gt;= 1.1.0',
        default_options : [
                            'warning_level=1',
                            'buildtype=release'
                          ])
fc = meson.get_compiler('fortran')

py = import('python').find_installation('''/usr/bin/python''', pure: false)
py_dep = py.dependency()

incdir_numpy = run_command(py,
  ['-c', 'import os; os.chdir(".."); import numpy; print(numpy.get_include())'],
  check : true
).stdout().strip()

incdir_f2py = run_command(py,
    ['-c', 'import os; os.chdir(".."); import numpy.f2py; print(numpy.f2py.get_include())'],
    check : true
).stdout().strip()

inc_np = include_directories(incdir_numpy)
np_dep = declare_dependency(include_directories: inc_np)

incdir_f2py = incdir_numpy / '..' / '..' / 'f2py' / 'src'
inc_f2py = include_directories(incdir_f2py)
fortranobject_c = incdir_f2py / 'fortranobject.c'

inc_np = include_directories(incdir_numpy, incdir_f2py)
# gh-25000
quadmath_dep = fc.find_library('quadmath', required: false)

py.extension_module('tmp',
                     [
                     '''geometry.f90''',
                     '''tmpmodule.c''',
                     '''tmp-f2pywrappers.f''',
                     fortranobject_c
                     ],
                     include_directories: [
                     inc_np,
                     ],
                     objects: [
                     ],
                     dependencies : [
                     py_dep,
                     quadmath_dep,
                     ],
                     install : true)</code></pre>
</div>
</div>
</div>
</div>
<p>We could take inspiration from this, generate sources, and link them
together:</p>
<pre class="meson"><code>f2py_prog = find_program('f2py')
# Generate Wrappers
geometry_source = custom_target('geometrymodule.c',
  input : ['src/chemlib/geometry.f90'],
  output : ['geometrymodule.c', 'geometry-f2pywrappers.f'],
  command : [f2py_prog, '-m', 'geometry', '@INPUT@', '--build-dir', '@OUTDIR@']
)</code></pre>
<p>A pattern commonly used in SciPy for instance. Here we will consider
a less tool-heavy approach though build backends such as <code class="verbatim">meson-python</code>, <code class="verbatim">scikit-build-core</code>, and <code class="verbatim">setuptools</code> orchestrate complex builds.</p>
<div class="section level3">
<h3 id="the-manual-install">The “Manual” Install<a class="anchor" aria-label="anchor" href="#the-manual-install"></a>
</h3>
<p>For now, let’s consider falling back to what we learned about
installation.</p>
<div id="challenge-the-site-packages-hack" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-the-site-packages-hack" class="callout-inner">
<h3 class="callout-title">Challenge: The Site-Packages Hack</h3>
<div class="callout-content">
<p>Your goal: Make the <code>tmp</code> module importable from anywhere
in your system (within the current environment), not just the source
folder.</p>
<p>Locate the active <code>site-packages</code> directory for your
current environment.</p>
<p>Copy the compiled <code>.so</code> (or <code>.pyd</code>) file into
that directory.</p>
<p>Change your directory to <code>$HOME</code> (to ensure you do not
import the local file).</p>
<p>Launch Python and attempt to <code>import tmp</code>.</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>Hint: You can find the install location using:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">uv</span> run python <span class="at">-c</span> <span class="st">"import site; print(site.getsitepackages()[0])"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">1.</span> Get the path</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="va">SITE_PACKAGES</span><span class="op">=</span><span class="va">$(</span><span class="ex">uv</span> run python <span class="at">-c</span> <span class="st">"import site; print(site.getsitepackages()[0])"</span><span class="va">)</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="ex">2.</span> Copy the artifact</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">cp</span> src/chemlib/tmp.cpython<span class="pp">*</span>.so <span class="st">"</span><span class="va">$SITE_PACKAGES</span><span class="st">/"</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="ex">3.</span> Move away and test</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="bu">cd</span> ~ uv run python <span class="at">-c</span> <span class="st">"import tmp; print(tmp.calc_distance([0,0,0], [1,1,1]))"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This manual exercise mimics exactly how libraries like <code class="verbatim">openblas</code>, <code class="verbatim">metatensor</code>, and <code class="verbatim">torch</code> operate. If you examine their installed
folders, you will find large compiled shared objects.</p>
<p>The Python files (<code class="verbatim">__init__.py</code>) serve
mostly as wrappers to load these binary blobs. For example, a robust
package might look like this:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>    <span class="im">from</span> . <span class="im">import</span> _geometry_backend</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:  <span class="co"># Logic to handle missing binaries or wrong platforms</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ImportError</span>(<span class="st">"Could not load the compiled extension!"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="kw">def</span> calc_distance(a, b):  <span class="co"># Pure Python type checking before passing to Fortran</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    <span class="cf">return</span> _geometry_backend.calc_distance(a, b)</span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="the-wheelhouse">The Wheelhouse<a class="anchor" aria-label="anchor" href="#the-wheelhouse"></a>
</h2>
<hr class="half-width">
<p>We now possess a working shared object. However, a critical flaw
remains: <strong>Portability</strong>.</p>
<p>The <code>.so</code> file you just generated links against:</p>
<ul>
<li>The specific version of Python on your machine.</li>
<li>The system C library (glibc) on your machine.</li>
<li>The CPU architecture (x86<sub>64</sub>, ARM64) of your machine.</li>
</ul>
<p>If you email this file to a colleague running Windows, or even a
different version of Linux, it will crash.</p>
<p>To distribute this code, we cannot ask every user to install a
Fortran compiler and run <code>f2py</code>. Instead, we use
<code>cibuildwheel</code> to distribute binaries to end users.</p>
<p>A “Wheel” (<code>.whl</code>) functions as a ZIP archive containing
the artifacts we just manually moved. To support the community, we must
generate wheels for every combination of:</p>
<ul>
<li>Operating System (Windows, macOS, Linux)</li>
<li>Python Version (3.10, 3.11, 3.12, 3.13, 3.14)</li>
<li>Architecture (x86, ARM)</li>
</ul>
<p>Tools like <code>cibuildwheel</code> automate this matrix. They spin
up isolated environments (often using Docker or virtual machines),
compile the code, fix the library linkages (bundling dependencies), and
produce the final artifacts.</p>
<figure><img src="../fig/cibuildwheel-matrix.png" alt="Diagram showing a single source repository being split by cibuildwheel into multiple OS-specific binary wheels uploaded to PyPI" class="figure mx-auto d-block"><div class="figcaption">Diagram showing a single source repository being
split by cibuildwheel into multiple OS-specific binary wheels uploaded
to PyPI</div>
</figure><div id="challenge-conceptualizing-the-pipeline" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-conceptualizing-the-pipeline" class="callout-inner">
<h3 class="callout-title">Challenge: Conceptualizing the Pipeline</h3>
<div class="callout-content">
<p>Imagine you publish <code>chemlib</code>. A user reports:</p>
<p>“ImportError: DLL load failed: The specified module could not be
found.”</p>
<p>Based on today’s lesson, what likely went wrong?</p>
<ol style="list-style-type: decimal">
<li>The Python code has a syntax error.</li>
<li>The user’s computer lacks a Fortran compiler.</li>
<li>The specific shared object for their OS/Python version was missing
or incompatible.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Answer: 3.</p>
<p>The error “DLL load failed” implies the Python interpreter attempted
to load the shared object but failed. This usually occurs when the
binary wheel does not match the user’s system, or the wheel failed to
bundle a required system library. The user does not need a compiler
(Option 2) if they are using a Wheel.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="the-manylinux-standard">The Manylinux Standard<a class="anchor" aria-label="anchor" href="#the-manylinux-standard"></a>
</h3>
<p>On Linux, binary compatibility presents a challenge due to varying
system libraries (glibc). <code>cibuildwheel</code> addresses this by
executing the build inside a specialized Docker container (Manylinux).
This ensures the compiled <code>.so</code> file links against an older
version of glibc, guaranteeing functionality on the majority of Linux
distributions.</p>
<div id="challenge-inspecting-an-artifact" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="challenge-inspecting-an-artifact" class="callout-inner">
<h3 class="callout-title">Challenge: Inspecting an Artifact</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Go to the PyPI page for <code>metatomic</code>.</li>
<li>You will observe a file ending in <code>.whl</code>.</li>
<li>Treat this file as a ZIP archive (which it represents). Unzip
it.</li>
<li>Locate the <code>.so</code> (or <code>.pyd</code>) file inside.</li>
</ol>
<p><strong>Reflection:</strong> This binary file constitutes the actual
product consumed by users. The Fortran source code effectively
disappears, becoming baked into the machine code of this shared
object.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<strong>Shared Objects:</strong> Scientific Python packages function
primarily as delivery mechanisms for compiled binaries (<code>.so</code>
files).</li>
<li>
<strong>Installation</strong>: “Installing” a package physically
amounts to copying these binaries into site-packages.</li>
<li>
<strong>Cibuildwheel:</strong> Automates the creation of binary
wheels for all platforms, removing the need for users to possess
compilers.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/HaoZeke/python_packaging_workbench/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/HaoZeke/python_packaging_workbench/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/HaoZeke/python_packaging_workbench/" class="external-link">Source</a></p>
        <p>
        <a href="../citation.html">Cite</a>
        | <a href="mailto:rgoswami@ieee.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
		</div>
		<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/" class="external-link">sandpaper (0.18.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/" class="external-link">varnish (1.0.9)</a></p>
		</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://HaoZeke.github.io/python_packaging_workbench/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, lesson, python, packaging, scripts",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://HaoZeke.github.io/python_packaging_workbench/instructor/aio.html",
  "identifier": "https://HaoZeke.github.io/python_packaging_workbench/instructor/aio.html",
  "dateCreated": "2026-02-10",
  "dateModified": "2026-02-15",
  "datePublished": "2026-02-15"
}

  </script><script>
		feather.replace();
	</script><script defer data-domain="pydissem.rgoswami.me" src="https://analytics.turtletech.us/js/script.outbound-links.js"></script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

